<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelDraw</title>
    <link id="favicon" rel="icon" href="icons/favicon.svg">
    <style>
        :root {
            --bg-dark: #1e1e1e;
            --bg-medium: #2d2d2d;
            --bg-light: #3a3a3a;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --accent: #4285f4;
            --accent-rgb: 66, 133, 244;
            /* RGB values of the accent color */
            --accent-hover: #5a95f5;
            --danger: #ea4335;
            --danger-hover: #fa5545;
            --success: #34a853;
            --success-hover: #44b863;
            --warning: #fbbc05;
            --warning-hover: #fcc515;
            --border-radius: 4px;
            --panel-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }


        /* Updated light theme with modern clean grays */
        body.light-theme {
            --bg-dark: #ececec;
            /* Darker workspace background */
            --bg-medium: #f0f0f0;
            /* Clean gray for panels */
            --bg-light: #e1e1e1;
            /* White UI elements */
            --text-primary: #202020;
            --text-secondary: #606060;
            --accent: #4285f4;
            --accent-rgb: 66, 133, 244;
            /* RGB values of the accent color */
            --accent-hover: #3b77db;
            --danger: #ea4335;
            --danger-hover: #d33426;
            --success: #34a853;
            --success-hover: #2e9549;
            --warning: #fbbc05;
            --warning-hover: #f0b400;
            --panel-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
            --border-radius: 4px;
        }

        /* Theme toggle switch styles */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-light);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            padding: 0 3px;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            background-color: var(--text-primary);
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        input:checked+.theme-slider:before {
            transform: translateX(26px);
        }

        .theme-slider .icon {
            position: absolute;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .theme-slider .sun-icon {
            right: 5px;
            color: var(--text-primary);
        }

        .theme-slider .moon-icon {
            left: 5px;
            color: var(--text-primary);
        }

        /* Enhanced hover interactions for Canvas Size inputs and dropdown */
        select,
        input[type="number"] {
            transition: border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease !important;
        }

        select:hover {
            border-color: rgba(255, 255, 255, 0.35) !important;
            background-color: rgba(255, 255, 255, 0.03) !important;
        }

        body.light-theme select:hover {
            border-color: rgba(0, 0, 0, 0.35) !important;
            background-color: #ffffff !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06) !important;
        }

        select:focus {
            outline: none !important;
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 2px rgba(var(--accent-rgb), 0.2) !important;
        }

        input[type="number"]:hover {
            border-color: rgba(255, 255, 255, 0.35) !important;
            background-color: rgba(255, 255, 255, 0.03) !important;
        }

        input[type="number"]:focus {
            outline: none !important;
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 2px rgba(var(--accent-rgb), 0.2) !important;
        }

        body.light-theme input[type="number"]:hover {
            border-color: rgba(0, 0, 0, 0.35) !important;
            background-color: #ffffff !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06) !important;
        }

        body.light-theme input[type="number"]:focus {
            box-shadow: 0 0 0 2px rgba(var(--accent-rgb), 0.2) !important;
        }

        .effect-control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            gap: 12px;
            width: 100%;
        }

        .effect-control.expandable .effect-control-header {
            margin-bottom: 6px;
        }

        .effect-control-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: inherit;
            font: inherit;
            padding: 2px 12px 2px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .effect-control-toggle:focus-visible {
            outline: 1px solid var(--accent);
            outline-offset: 2px;
        }

        .effect-chevron-wrapper {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .effect-control-toggle:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        body.light-theme .effect-control-toggle:hover {
            background-color: rgba(0, 0, 0, 0.06);
        }

        .effect-chevron {
            width: 12px;
            height: 12px;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
            transform: rotate(-90deg);
        }

        .effect-control.expanded .effect-chevron {
            transform: rotate(0deg);
        }

        .effect-label {
            font-size: 13px;
            color: var(--text-primary);
        }

        .effect-extra {
            display: none;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .effect-control.expanded .effect-extra {
            display: flex;
        }

        .effect-extra-label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .effect-extra-description {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* Help button styles */
        .help-button:hover {
            background-color: var(--bg-light) !important;
            opacity: 1 !important;
        }

        /* Help modal styles */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .help-modal-content {
            position: relative;
            background-color: var(--bg-medium);
            border-radius: 12px;
            box-shadow: var(--panel-shadow);
            width: 90%;
            max-width: 480px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        body.light-theme .help-modal-content {
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-theme .help-modal-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .help-modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .help-modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px;
            border-radius: var(--border-radius);
            transition: background-color 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-modal-close:hover {
            background-color: var(--bg-light);
            color: var(--text-primary);
        }

        .help-modal-body {
            padding: 20px 24px;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-y: auto;
            flex: 1;
        }

        .help-modal-body p {
            margin: 0 0 16px 0;
        }

        .help-modal-body p:last-child {
            margin-bottom: 0;
        }

        /* EULA styles */
        .eula-section {
            margin-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-theme .eula-section {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .eula-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 0 8px 0;
            cursor: pointer;
            color: var(--text-primary);
            transition: color 0.2s;
        }

        .eula-header:hover {
            color: var(--accent);
        }

        .eula-expand-icon {
            width: 16px;
            height: 16px;
            transition: transform 0.2s ease;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .eula-expand-icon {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .eula-header.collapsed .eula-expand-icon {
            transform: rotate(-90deg);
        }

        .eula-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 8px 0;
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 16px;
            margin: 8px 0;
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-secondary);
            display: block;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .eula-content.collapsed {
            max-height: 0;
            opacity: 0;
            padding: 0 16px;
            margin: 0;
            overflow: hidden;
        }

        .eula-content h3 {
            color: var(--text-primary);
            margin: 16px 0 8px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .eula-content h3:first-child {
            margin-top: 0;
        }

        .eula-content p {
            margin-bottom: 12px;
        }

        .eula-content p:last-child {
            margin-bottom: 0;
        }

        .help-modal-footer {
            padding: 20px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
        }

        body.light-theme .help-modal-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .discover-more-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .discover-more-btn:hover {
            background-color: var(--accent-hover);
        }

        /* Selection action buttons */
        .action-btn:hover {
            background-color: var(--accent) !important;
        }

        body.light-theme .action-btn {
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
        }

        body.light-theme .action-btn img {
            filter: invert(20%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%) !important;
        }

        /* Context Menu styles */
        .context-menu {
            position: fixed;
            background-color: var(--bg-medium);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 4px 0;
            min-width: 180px;
            z-index: 10001;
        }

        body.light-theme .context-menu {
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 13px;
            transition: background-color 0.2s;
        }

        .context-menu-item:hover {
            background-color: var(--bg-light);
        }

        .context-menu-item.disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .context-menu-item.disabled:hover {
            background-color: transparent;
        }

        .context-menu-shortcut {
            color: var(--text-secondary);
            font-size: 11px;
            margin-left: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            display: grid;
            grid-template-columns: 90px 1fr;
            grid-template-rows: 50px 1fr 30px;
            grid-template-areas:
                "header header"
                "toolbar content"
                "toolbar footer";
            height: 100vh;
            overflow: hidden;
        }

        body.light-theme {
            background-color: var(--bg-light);
            color: var(--text-primary);
        }

        /* Header */
        .header {
            grid-area: header;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background-color: var(--bg-medium);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        body.light-theme .header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
            display: flex;
            align-items: center;
            margin-left: 44px;
        }

        .app-title {
            position: relative;
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            align-items: center;
        }

        .app-title:hover {
            color: var(--accent);
        }

        .version-tooltip {
            position: absolute;
            top: -4px;
            right: -36px;
            font-size: 10px;
            font-weight: 400;
            color: var(--text-secondary);
            opacity: 0;
            transform: translateY(5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            background-color: var(--bg-light);
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }

        body.light-theme .version-tooltip {
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .app-title:hover .version-tooltip {
            opacity: 1;
            transform: translateY(0);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 18px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-controls select {
            margin: 0;
        }

        .header-controls select {
            width: 200px;
        }

        .control-label {
            font-size: 13px;
            color: var(--text-secondary);
            display: inline-block;
            width: 120px;
            text-align: left;
            white-space: nowrap;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
            width: 100%;
        }

        .control-row select {
            flex: 0 0 200px;
        }

        .settings-content {
            --label-width: 120px;
        }

        .settings-content .control-label {
            width: auto;
            display: block;
            text-align: left;
        }

        .settings-content .control-row select {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            margin-left: 0;
            height: 32px;
            flex: 0 0 auto;
        }

        .settings-content .control-row {
            flex-direction: column;
            align-items: stretch;
            gap: 6px;
        }

        .panel-content.settings-content {
            flex: 0 0 auto;
        }

        /* Segmented control styles */
        .segmented-control {
            display: flex;
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 2px;
            gap: 2px;
            width: 100%;
        }

        .segment-btn {
            background: none;
            border: none;
            padding: 6px 10px;
            cursor: pointer;
            border-radius: calc(var(--border-radius) - 1px);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            height: 32px;
        }

        .segment-btn img {
            width: 18px;
            height: 18px;
            display: block;
            filter: invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme .segment-btn img {
            filter: invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .segment-btn:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.light-theme .segment-btn:hover:not(.active) {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .segment-btn:hover:not(.active) img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .segment-btn:hover:not(.active) img {
            filter: invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
        }

        .segment-btn.active {
            background-color: var(--accent);
        }

        .segment-btn.active img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .segment-btn.active img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Opacity control styles */
        #opacity-control {
            display: none;
            align-items: center;
            gap: 8px;
            margin-right: 12px;
            padding: 4px 12px;
            background-color: rgba(0, 0, 0, 0.15);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        body.light-theme #opacity-control {
            background-color: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        #opacity-control label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        #brush-size-control {
            gap: 8px;
            margin-right: 12px;
            padding: 4px 12px;
            background-color: rgba(0, 0, 0, 0.15);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
            align-items: center;
        }

        body.light-theme #brush-size-control {
            background-color: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        #brush-size-control label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .opacity-slider-wrapper {
            position: relative;
            width: 120px;
            height: 14px;
            display: flex;
            align-items: center;
        }

        .opacity-slider-wrapper::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            width: 100%;
            background: var(--bg-light);
            border-radius: 2px;
            pointer-events: none;
            z-index: 0;
        }

        .opacity-slider-wrapper::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            background: rgba(var(--accent-rgb), 0.3);
            border-radius: 2px;
            pointer-events: none;
            width: var(--slider-progress, 100%);
            transition: none;
            z-index: 1;
        }

        #opacity-slider {
            position: relative;
            width: 100%;
            height: 14px;
            cursor: pointer;
            background: transparent;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            z-index: 2;
            margin: 0;
        }

        #brush-size-slider {
            position: relative;
            width: 100%;
            height: 14px;
            cursor: pointer;
            background: transparent;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            z-index: 2;
            margin: 0;
        }

        #opacity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 0;
        }

        #brush-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 0;
        }

        #opacity-slider::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        #brush-size-slider::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        #opacity-slider::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        #brush-size-slider::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        #opacity-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        #brush-size-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        #opacity-slider::-moz-range-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        #brush-size-slider::-moz-range-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        #opacity-slider::-moz-range-thumb:active {
            transform: scale(0.95);
        }

        #brush-size-slider::-moz-range-thumb:active {
            transform: scale(0.95);
        }

        #opacity-slider::-moz-range-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        #brush-size-slider::-moz-range-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        #opacity-slider::-webkit-slider-runnable-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        #brush-size-slider::-webkit-slider-runnable-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        #opacity-value {
            font-size: 13px;
            color: var(--text-primary);
            min-width: 40px;
            text-align: right;
        }

        #brush-size-value {
            font-size: 13px;
            color: var(--text-primary);
            min-width: 40px;
            text-align: right;
        }

        .opacity-value-editable {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
            user-select: none;
        }

        .opacity-value-editable:hover {
            background-color: var(--bg-light);
        }

        .opacity-value-input {
            width: 50px;
            padding: 2px 4px;
            border: 1px solid var(--accent);
            border-radius: 3px;
            background-color: var(--bg-light);
            color: var(--text-primary);
            font-size: 13px;
            text-align: right;
            outline: none;
        }

        /* Live Effects Sliders */
        .effect-slider-wrapper {
            position: relative;
            width: 100%;
            height: 14px;
            display: flex;
            align-items: center;
        }

        .effect-slider-wrapper::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            width: 100%;
            background: var(--bg-light);
            border-radius: 2px;
            pointer-events: none;
            z-index: 0;
        }

        .effect-slider-wrapper::before {
            content: '';
            position: absolute;
            left: var(--progress-left, 50%);
            top: 50%;
            transform: translateY(-50%);
            width: var(--progress-width, 0%);
            height: 4px;
            background: rgba(var(--accent-rgb), 0.3);
            border-radius: 2px;
            pointer-events: none;
            z-index: 1;
            transition: none;
        }

        .effect-control input[type="range"] {
            position: relative;
            width: 100%;
            height: 14px;
            cursor: pointer;
            background: transparent;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            z-index: 2;
            margin: 0;
        }

        .effect-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 0;
        }

        .effect-control input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .effect-control input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        .effect-control input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .effect-control input[type="range"]::-moz-range-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .effect-control input[type="range"]::-moz-range-thumb:active {
            transform: scale(0.95);
        }

        .effect-control input[type="range"]::-moz-range-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        .effect-control input[type="range"]::-webkit-slider-runnable-track {
            background: transparent;
            height: 14px;
            border: none;
        }

        .effect-control input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .effect-value-editable:hover {
            background-color: var(--bg-light);
        }

        .effect-value-input {
            width: 50px;
            padding: 2px 4px;
            border: 1px solid var(--accent);
            border-radius: 3px;
            background-color: var(--bg-light);
            color: var(--text-primary);
            font-size: 12px;
            text-align: right;
            outline: none;
        }

        /* Sidebar Toolbar */
        .sidebar {
            grid-area: toolbar;
            background-color: var(--bg-medium);
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-auto-rows: min-content;
            gap: 0;
            padding: 12px 9px 96px 9px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            height: 100%;
            align-content: start;
            position: relative;
        }

        body.light-theme .sidebar {
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Sidebar Footer */
        .sidebar-footer {
            position: relative;
            width: 100%;
            padding: 16px 20px;
            text-align: center;
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        body.light-theme .sidebar-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .footer-text {
            font-size: 11px;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.4;
            opacity: 0.6;
        }

        .footer-link {
            color: inherit;
            text-decoration: none;
            position: relative;
            transition: color 0.25s ease, opacity 0.25s ease;
        }

        .footer-link:hover {
            opacity: 1;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 1px;
            background-color: var(--accent);
            transform: translateX(-50%);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .footer-link:hover {
            color: var(--accent);
        }

        .footer-link:hover::after {
            width: 100%;
        }

        .footer-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--bg-light);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        body.light-theme .footer-tooltip {
            background-color: var(--bg-medium);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .footer-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--bg-light);
        }

        body.light-theme .footer-tooltip::after {
            border-top-color: var(--bg-medium);
        }

        .footer-link:hover~.footer-tooltip {
            animation: showTooltip 0.3s ease 1.2s forwards;
        }

        @keyframes showTooltip {
            to {
                opacity: 1;
            }
        }

        .app-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.18s cubic-bezier(.4, 1.2, .6, 1);
            cursor: pointer;
            width: 32px;
            height: 32px;
            overflow: visible;
            margin-right: 12px;
        }

        .app-icon:hover,
        .app-icon:focus {
            transform: scale(1.12);
            box-shadow: 0 2px 10px 0 rgba(66, 133, 244, 0.10);
            outline: 1px solid var(--accent);
            border-radius: var(--border-radius);
        }

        .app-icon svg,
        .app-icon img {
            display: block;
            width: 100%;
            height: 100%;
        }

        .tool {
            background: none;
            border: none;
            padding: 0;
            margin: 0 0 6px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius);
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .tool svg,
        .tool object,
        .tool img {
            width: 20px;
            height: 20px;
            display: block;
        }

        .tool img {
            filter: invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        .tool:hover img,
        .tool:focus img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        .tool.active img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .tool img {
            filter: invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme .tool:hover img,
        body.light-theme .tool:focus img {
            filter: invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
        }

        body.light-theme .tool.active img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        .tool:hover,
        .tool:focus {
            background-color: var(--bg-light);
            color: var(--text-primary);
        }

        .tool.active {
            background-color: var(--accent);
            color: white;
        }

        /* Tool group with dropdown */
        .tool-group {
            position: relative;
            margin: 0 0 6px 0;
            grid-column: span 1;
        }

        .tool-icon-wrapper {
            position: relative;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-dropdown-indicator {
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 10px;
            height: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            transform: rotate(-45deg);
            cursor: pointer;
            z-index: 10;
        }

        .tool-dropdown-indicator svg {
            width: 8px;
            height: 8px;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .tool-dropdown-indicator svg path {
            transition: fill 0.2s ease, stroke 0.2s ease;
        }

        .tool-dropdown-indicator:hover svg {
            color: var(--accent);
        }

        .tool-dropdown-indicator:hover svg path {
            fill: var(--accent);
            stroke: var(--accent);
        }

        .tool.active .tool-dropdown-indicator svg {
            color: white;
        }

        body.light-theme .tool.active .tool-dropdown-indicator svg {
            color: white;
        }

        .tool-dropdown {
            position: absolute;
            left: 100%;
            top: 0;
            margin-left: 4px;
            background-color: var(--bg-medium);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow);
            padding: 4px;
            display: none;
            flex-direction: column;
            gap: 2px;
            min-width: 140px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(-5px);
            transition: opacity 0.15s ease, transform 0.15s ease;
        }

        body.light-theme .tool-dropdown {
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Show dropdown when it has the 'show' class */
        .tool-dropdown.show {
            display: flex;
            opacity: 1;
            transform: translateX(0);
        }

        @keyframes fadeInDropdown {
            from {
                opacity: 0;
                transform: translateX(-5px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .tool-dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: calc(var(--border-radius) - 2px);
            transition: background-color 0.2s ease;
            color: var(--text-primary);
            font-size: 13px;
        }

        .tool-dropdown-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: var(--text-secondary);
        }

        .tool-dropdown-item img {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            filter: invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .tool-dropdown-item img {
            filter: invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .tool-dropdown-item:hover {
            background-color: var(--bg-light);
        }

        .tool-dropdown-item:hover svg {
            color: var(--text-primary);
        }

        .tool-dropdown-item:hover img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .tool-dropdown-item:hover img {
            filter: invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
        }

        .tool-dropdown-item.active {
            background-color: rgba(var(--accent-rgb), 0.15);
        }

        .tool-dropdown-item.active svg {
            color: var(--accent);
        }

        .tool-dropdown-item.active img {
            filter: brightness(0) saturate(100%) invert(52%) sepia(98%) saturate(3408%) hue-rotate(204deg) brightness(98%) contrast(92%);
        }

        body.light-theme .tool-dropdown-item.active img {
            filter: brightness(0) saturate(100%) invert(52%) sepia(98%) saturate(3408%) hue-rotate(204deg) brightness(98%) contrast(92%);
        }

        /* Save/Load Project button specific hover styles - must come after general .tool styles */
        #save-project-btn:hover img,
        #load-project-btn:hover img,
        #save-project-panel-btn:hover img,
        #load-project-panel-btn:hover img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%) !important;
        }

        #save-project-btn:hover,
        #load-project-btn:hover,
        #save-project-panel-btn:hover,
        #load-project-panel-btn:hover {
            background-color: var(--accent) !important;
        }

        body.light-theme #save-project-btn:hover img,
        body.light-theme #load-project-btn:hover img,
        body.light-theme #save-project-panel-btn:hover img,
        body.light-theme #load-project-panel-btn:hover img,
        body.light-theme #save-project-btn:focus img,
        body.light-theme #load-project-btn:focus img,
        body.light-theme #save-project-panel-btn:focus img,
        body.light-theme #load-project-panel-btn:focus img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%) !important;
        }

        body.light-theme #save-project-btn:hover,
        body.light-theme #load-project-btn:hover,
        body.light-theme #save-project-panel-btn:hover,
        body.light-theme #load-project-panel-btn:hover {
            background-color: var(--accent) !important;
            color: #ffffff !important;
        }

        /* Ensure Save/Load icons turn white on hover in Light Mode, including inline SVGs */
        body.light-theme #save-project-btn:hover img,
        body.light-theme #load-project-btn:hover img,
        body.light-theme #save-project-panel-btn:hover img,
        body.light-theme #load-project-panel-btn:hover img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%) !important;
        }

        /* Inline SVG variants (toolbar/panel) */
        body.light-theme #save-project-btn:hover svg,
        body.light-theme #load-project-btn:hover svg,
        body.light-theme #save-project-panel-btn:hover svg,
        body.light-theme #load-project-panel-btn:hover svg,
        body.light-theme #save-project-btn:hover svg *,
        body.light-theme #load-project-btn:hover svg *,
        body.light-theme #save-project-panel-btn:hover svg *,
        body.light-theme #load-project-panel-btn:hover svg *,
        body.light-theme #save-project-btn:focus svg,
        body.light-theme #load-project-btn:focus svg,
        body.light-theme #save-project-panel-btn:focus svg,
        body.light-theme #load-project-panel-btn:focus svg,
        body.light-theme #save-project-btn:focus svg *,
        body.light-theme #load-project-btn:focus svg *,
        body.light-theme #save-project-panel-btn:focus svg *,
        body.light-theme #load-project-panel-btn:focus svg * {
            fill: #ffffff !important;
            stroke: none !important;
        }

        /* Main Content */
        .content {
            grid-area: content;
            display: flex;
            flex-direction: row-reverse;
            padding: 20px;
            gap: 20px;
            overflow: auto;
        }

        /* Color Palette */
        .panel {
            background-color: var(--bg-medium);
            border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
            flex: 0 0 auto;
            /* Allow panels to grow by default */
        }

        /* Export panel should have fixed height */
        .panel.export-panel {
            flex: 0 0 auto;
            /* Don't grow or shrink */
        }

        /* When panel is collapsed, it should only take the space of its header */
        .panel.collapsed {
            flex: 0 0 auto;
        }

        .panel-header {
            background-color: var(--bg-light);
            padding: 8px 12px;
            font-size: 13px;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .panel-header:hover {
            background-color: var(--bg-light);
            filter: brightness(1.1);
        }

        /* Removed old expand-triangle CSS rules - now using SVG icons */

        .panel-content {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow-y: auto;
            padding: 16px 16px 20px 16px;
            box-sizing: border-box;
            transition: max-height 0.3s ease;
        }

        .panel-content.collapsed {
            max-height: 0;
            padding: 0 16px;
            overflow: hidden;
        }

        /* Hide footer when panel is collapsed */
        .panel.collapsed .panel-footer {
            display: none !important;
        }

        .left-panels {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 280px;
            gap: 20px;
            height: 100%;
            min-height: 0;
            overflow-y: auto;
        }

        .color-picker {
            max-width: 100%;
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            height: auto;
            max-height: 280px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--bg-light) var(--bg-medium);
            padding-bottom: 8px;
            padding-right: 8px;
            position: relative;
            isolation: isolate;
        }

        .color-picker::-webkit-scrollbar {
            width: 8px;
        }

        .color-picker::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 4px;
            border: 2px solid var(--bg-medium);
        }

        .color-picker::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .color-picker::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }

        .color {
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent;
            position: relative;
            z-index: 1;
        }

        .color:hover {
            transform: scale(1.05);
        }

        .color.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 1px var(--accent);
        }

        /* List View Styles */
        .color-picker.list-view {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .color-picker.list-view .color {
            width: 100%;
            height: 32px;
            /* Keep consistent height */
            display: flex;
            align-items: center;
            padding: 0 8px;
            box-sizing: border-box;
            border-radius: var(--border-radius);
            background-color: transparent;
            transition: background-color 0.2s;
        }

        /* Remove scale/offset on hover in list view - only highlight with fill color */
        .color-picker.list-view .color:hover {
            transform: none;
            background-color: rgba(255, 255, 255, 0.08);
        }

        body.light-theme .color-picker.list-view .color:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* More subtle selection highlight in list view */
        .color-picker.list-view .color.selected {
            border: 2px solid transparent;
            box-shadow: none;
            background-color: rgba(var(--accent-rgb), 0.15);
        }

        .color-picker.list-view .color.selected:hover {
            background-color: rgba(var(--accent-rgb), 0.2);
        }

        /* Inner swatch for list view to show color */
        .color .swatch-preview {
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius);
            border: 2px solid transparent;
            flex-shrink: 0;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        /* Grid view swatch styling */
        .color-picker:not(.list-view) .color .swatch-preview {
            display: none;
        }

        /* Swatch selected state in list view */
        .color-picker.list-view .color.selected .swatch-preview {
            border: 2px solid white;
            box-shadow: 0 0 0 1px var(--accent);
        }

        .color .hex-label {
            display: none;
            margin-left: 12px;
            font-family: monospace;
            font-size: 12px;
            color: var(--text-primary);
            cursor: text;
            pointer-events: auto;
            padding: 4px 6px;
            border-radius: 3px;
            transition: background-color 0.2s;
            user-select: none;
            flex: 1;
        }

        .color .hex-label:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        body.light-theme .color .hex-label:hover {
            background-color: rgba(0, 0, 0, 0.08);
        }

        .color-picker.list-view .color .hex-label {
            display: block;
        }

        /* Delete button for list view */
        .color .delete-btn {
            display: none;
            width: 24px;
            height: 24px;
            border-radius: 3px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            margin-left: 8px;
            flex-shrink: 0;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            color: var(--text-secondary);
        }

        .color-picker.list-view .color:hover .delete-btn {
            display: flex;
        }

        .color .delete-btn:hover {
            background-color: var(--danger);
            color: white;
        }

        .color .delete-btn svg {
            width: 14px;
            height: 14px;
            pointer-events: none;
        }

        /* Dragging state */
        .color.dragging {
            opacity: 0.4;
        }

        .color.drag-over {
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 2px var(--accent);
        }

        /* View Toggle Button in Color Palette Footer */
        .panel-footer #palette-view-toggle-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #palette-view-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.light-theme .panel-footer #palette-view-toggle-btn:hover {
            background-color: rgba(0, 0, 0, 0.05) !important;
        }

        .panel-footer #palette-view-toggle-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #palette-view-toggle-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #palette-view-toggle-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        body.light-theme .panel-footer #palette-view-toggle-btn:hover img {
            filter: brightness(0) invert(0%) !important;
        }

        /* Canvas Container */
        .canvas-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #222222;
            border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow);
            width: 90vw;
            height: 100%;
            overflow: auto;
            max-width: 100vw;
            max-height: 100vh;
            position: relative;
        }

        body.light-theme .canvas-container {
            background-color: var(--bg-dark);
        }

        .pixel-grid-wrapper {
            background-color: var(--bg-light);
            /* Lighter background for dark mode */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
            padding: 2px;
            border-radius: 2px;
            min-width: max-content;
            min-height: max-content;
            position: relative;
            transition: transform 0.2s ease;
            transform-origin: center;
        }

        body.light-theme .pixel-grid-wrapper {
            background-color: #f0f0f0;
            /* Restore light background for light mode */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
        }

        .pixel-grid {
            display: grid;
            border: none;
            position: relative;
            z-index: 1;
        }

        .pixel-grid.lines-grid {
            gap: 1px;
            background-color: rgba(0, 0, 0, 0.1);
        }

        body.light-theme .pixel-grid.lines-grid {
            background-color: rgba(0, 0, 0, 0.2);
        }

        .pixel-grid.lines-grid .pixel {
            border: none;
        }

        .pixel-grid.dot-grid {
            gap: 0;
            background-color: transparent;
        }

        .pixel-grid.dot-grid .pixel {
            border: none;
            position: relative;
        }

        .pixel-grid.dot-grid .pixel::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 2px;
            background: #bbb;
            border-radius: 50%;
            pointer-events: none;
            top: -1px;
            left: -1px;
        }

        body.light-theme .pixel-grid.dot-grid .pixel::before {
            background: #777;
        }

        .pixel-grid.dot-grid .pixel::after {
            display: none;
        }

        .pixel-grid.no-grid {
            gap: 0;
            background-color: transparent;
        }

        .pixel-grid.no-grid .pixel {
            border: none;
        }

        .pixel-grid.no-grid .pixel::before,
        .pixel-grid.no-grid .pixel::after {
            display: none;
        }

        .pixel-grid.alpha-grid {
            background-color: #2a2a2a;
            /* Darker background for dark mode */
            background-image: linear-gradient(45deg, #3a3a3a 25%, transparent 25%, transparent 75%, #3a3a3a 75%),
                linear-gradient(45deg, #3a3a3a 25%, transparent 25%, transparent 75%, #3a3a3a 75%);
            background-size: 16px 16px;
            background-position: 0 0, 8px 8px;
        }

        body.light-theme .pixel-grid.alpha-grid {
            background-color: #f0f0f0;
            /* Lighter background */
            background-image: linear-gradient(45deg, #e0e0e0 25%, transparent 25%, transparent 75%, #e0e0e0 75%),
                linear-gradient(45deg, #e0e0e0 25%, transparent 25%, transparent 75%, #e0e0e0 75%);
        }

        .pixel-grid.alpha-grid .pixel {
            background-color: transparent !important;
        }

        .pixel-grid.alpha-grid .pixel[data-filled="true"] {
            background: var(--pixel-color, white) !important;
        }

        .pixel {
            width: 25px;
            height: 25px;
            background-color: #2a2a2a;
            /* Dark background for dark mode */
            transition: all 0.1s ease;
        }

        body.light-theme .pixel {
            background-color: white;
            /* White background for light mode */
        }

        /* Custom cursor styles for different tools */
        /* Apply custom cursors only to the pixel grid and pixels, not the entire canvas container */
        .tool-draw .pixel-grid,
        .tool-draw .pixel {
            cursor: url("icons/cursor/draw-cursor.svg") 0 18, auto;
        }

        .tool-brush .pixel-grid,
        .tool-brush .pixel {
            cursor: url("icons/cursor/brush-cursor.svg") 0 18, auto;
        }

        .tool-erase .pixel-grid,
        .tool-erase .pixel {
            cursor: url("icons/cursor/erase-cursor.svg") 0 18, auto;
        }

        .tool-rectangle .pixel-grid,
        .tool-rectangle .pixel {
            cursor: url("icons/cursor/rectangle-cursor.svg") 0 18, auto;
        }

        .tool-ellipse .pixel-grid,
        .tool-ellipse .pixel {
            cursor: url("icons/cursor/ellipse-cursor.svg") 0 18, auto;
        }

        .tool-rect-select .pixel-grid,
        .tool-rect-select .pixel {
            cursor: url("icons/cursor/selection-square-cursor.svg") 0 18, auto;
        }

        .tool-rect-select.shift-pressed .pixel-grid,
        .tool-rect-select.shift-pressed .pixel {
            cursor: url("icons/cursor/selection-square-add-cursor.svg") 0 18, auto;
        }

        .tool-rect-select.alt-pressed .pixel-grid,
        .tool-rect-select.alt-pressed .pixel {
            cursor: url("icons/cursor/selection-square-subtract-cursor.svg") 0 18, auto;
        }

        .tool-move-select .pixel-grid,
        .tool-move-select .pixel {
            cursor: url("icons/cursor/selection-move-cursor.svg") 0 18, auto;
        }

        .tool-ellipse-select .pixel-grid,
        .tool-ellipse-select .pixel {
            cursor: url("icons/cursor/select-circular.svg") 0 18, auto;
        }

        .tool-ellipse-select.shift-pressed .pixel-grid,
        .tool-ellipse-select.shift-pressed .pixel {
            cursor: url("icons/cursor/select-circular.svg") 0 18, auto;
        }

        .tool-ellipse-select.alt-pressed .pixel-grid,
        .tool-ellipse-select.alt-pressed .pixel {
            cursor: url("icons/cursor/select-circular.svg") 0 18, auto;
        }

        /* Marching ants animation for selection */
        @keyframes marching-ants {
            0% {
                stroke-dashoffset: 0;
            }

            100% {
                stroke-dashoffset: 10;
            }
        }

        .selection-overlay {
            animation: marching-ants 1s linear infinite;
        }

        .tool-line .pixel-grid,
        .tool-line .pixel {
            cursor: url("icons/cursor/line-cursor.svg") 0 18, auto;
        }

        .tool-fill .pixel-grid,
        .tool-fill .pixel {
            cursor: url("icons/cursor/fill-cursor.svg") 0 18, auto;
        }

        .tool-eyedropper .pixel-grid,
        .tool-eyedropper .pixel {
            cursor: url("icons/cursor/eyedropper-cursor.svg") 0 18, auto;
        }

        .tool-eyedropper.eyedropper-filled .pixel-grid,
        .tool-eyedropper.eyedropper-filled .pixel {
            cursor: url("icons/cursor/eyedropper-cursor-filled.svg") 0 18, auto;
        }

        .tool-crop .pixel-grid,
        .tool-crop .pixel {
            cursor: crosshair;
        }

        /* Allow crop overlay to extend beyond canvas */
        .tool-crop .rect-dash-overlay {
            overflow: visible !important;
        }

        .tool-crop .rect-dash-overlay>* {
            overflow: visible !important;
        }

        .tool-move .pixel-grid,
        .tool-move .pixel {
            cursor: url("icons/cursor/move-cursor.svg") 0 18, auto;
        }

        /* Bottom Info / Status Bar */
        .footer {
            grid-area: footer;
            background-color: var(--bg-medium);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 0 15px;
            color: var(--text-secondary);
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-theme .footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        #status-bar {
            flex: 0 0 auto;
        }

        #coordinates {
            display: none;
        }

        /* Buttons and Controls */
        button {
            background-color: var(--bg-light);
            color: var(--text-primary);
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        button:hover {
            background-color: #494949;
        }

        button.primary {
            background-color: var(--accent);
            color: white;
        }

        button.primary:hover {
            background-color: var(--accent-hover);
        }

        button.danger {
            background-color: var(--danger);
            color: white;
        }

        button.danger:hover {
            background-color: var(--danger-hover);
        }

        button.success {
            background-color: var(--success);
            color: white;
        }

        button.success:hover {
            background-color: var(--success-hover);
        }

        button.warning {
            background-color: var(--warning);
            color: #333;
        }

        button.warning:hover {
            background-color: var(--warning-hover);
        }

        button.donate-btn {
            background-color: #ececec;
            color: var(--bg-dark);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e0e0e0;
        }

        button.donate-btn:hover {
            background-color: var(--accent);
            color: #fff;
        }

        .donate-btn svg {
            width: 18px;
            height: 18px;
        }

        .donate-heart {
            fill: var(--accent);
            transition: fill 0.2s;
        }

        button.donate-btn:hover .donate-heart {
            fill: #fff;
        }

        select {
            background-color: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: var(--border-radius);
            font-size: 13px;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px;
            padding-right: 25px;
        }

        body.light-theme select {
            background-color: #f8f8f8;
            /* Slightly lighter than bg-medium */
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }

        select:hover {
            border-color: rgba(255, 255, 255, 0.3);
        }

        body.light-theme select:hover {
            border-color: rgba(0, 0, 0, 0.3);
        }

        body.light-theme input[type="number"] {
            border: 1px solid rgba(0, 0, 0, 0.2) !important;
        }

        body.light-theme input[type="number"]:hover {
            border-color: rgba(0, 0, 0, 0.3) !important;
        }

        /* Responsive adjustments */
        @media (max-width: 800px) {
            body {
                grid-template-columns: 50px 1fr;
            }

            .left-panels {
                width: 180px;
            }

            .color {
                width: 35px;
                height: 35px;
            }

            .pixel {
                width: 20px;
                height: 20px;
            }

            /* Single column toolbar layout */
            .sidebar {
                grid-template-columns: 1fr;
                padding: 12px 6px 96px 6px;
            }

            /* Smaller color swatch button */
            #color-swatch-btn {
                width: 48px !important;
                height: 48px !important;
                left: 6px !important;
            }
        }

        @media (max-width: 600px) {
            body {
                grid-template-columns: 50px 1fr;
                grid-template-rows: auto 1fr 30px;
                grid-template-areas:
                    "toolbar header"
                    "toolbar content"
                    "toolbar footer";
            }

            .header {
                flex-wrap: wrap;
                gap: 8px;
                padding: 8px 12px;
            }

            .app-title {
                width: 100%;
                text-align: center;
            }

            .header-controls {
                position: static;
                left: auto;
                top: auto;
                transform: none;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .sidebar {
                grid-template-columns: 1fr;
                flex-direction: column;
                align-items: center;
                padding: 15px 6px 72px 6px;
                border-right: 1px solid rgba(255, 255, 255, 0.1);
                border-bottom: none;
                height: 100% !important;
            }

            /* Even smaller color swatch button for very narrow screens */
            #color-swatch-btn {
                width: 38px !important;
                height: 38px !important;
                left: 6px !important;
                bottom: 8px !important;
            }

            body.light-theme .sidebar {
                border-right: 1px solid rgba(0, 0, 0, 0.1);
                border-bottom: none;
            }

            .tool {
                margin: 0 0 8px 0;
            }

            .theme-switch {
                margin-left: 0;
            }

            .content {
                flex-direction: column-reverse;
                gap: 12px;
            }

            .left-panels {
                width: 100%;
            }

            .canvas-container {
                width: 100%;
                max-width: 100%;
            }
        }

        .save-buttons-column {
            margin-top: 16px;
            display: flex;
            flex-direction: column-reverse;
            gap: 8px;
            align-items: stretch;
            min-width: 0;
            overflow: visible;
        }

        .save-btn {
            background: #3A3A3A;
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 1rem;
            padding: 12px 0;
            width: 100%;
            box-sizing: border-box;
            white-space: normal;
            word-break: break-word;
        }

        /* Ensure inline SVG icons inside export/copy buttons follow the button's color */
        .save-btn svg {
            color: inherit;
            /* propagate color to SVG tree for currentColor */
            display: inline-block;
        }

        .save-btn svg path,
        .save-btn svg rect,
        .save-btn svg circle,
        .save-btn svg polygon,
        .save-btn svg polyline {
            fill: currentColor;
        }

        /* Strong hover override for light theme to guarantee white icons */
        body.light-theme .save-btn:hover svg,
        body.light-theme .save-btn:focus svg,
        body.light-theme .save-btn:hover svg *,
        body.light-theme .save-btn:focus svg * {
            fill: #fff !important;
        }

        /* Ensure white icons on hover/focus in all themes (explicit color + fill) */
        .save-btn:hover svg,
        .save-btn:focus svg {
            color: #fff !important;
        }

        .save-btn:hover svg *,
        .save-btn:focus svg * {
            fill: #fff !important;
        }

        /* ID-targeted overrides to ensure white icons on hover/focus */
        #save-btn:hover svg,
        #save-btn:focus svg,
        #save-svg-btn:hover svg,
        #save-svg-btn:focus svg,
        #copy-png-btn:hover svg,
        #copy-png-btn:focus svg,
        #copy-svg-btn:hover svg,
        #copy-svg-btn:focus svg {
            filter: none !important;
            color: #fff !important;
        }

        #save-btn:hover svg *,
        #save-btn:focus svg *,
        #save-svg-btn:hover svg *,
        #save-svg-btn:focus svg *,
        #copy-png-btn:hover svg *,
        #copy-png-btn:focus svg *,
        #copy-svg-btn:hover svg *,
        #copy-svg-btn:focus svg * {
            fill: #fff !important;
        }

        /* Absolute enforcement: turn every SVG shape white on hover/focus */
        .save-btn:hover svg path,
        .save-btn:hover svg rect,
        .save-btn:hover svg circle,
        .save-btn:hover svg polygon,
        .save-btn:hover svg polyline,
        .save-btn:hover svg line,
        .save-btn:focus svg path,
        .save-btn:focus svg rect,
        .save-btn:focus svg circle,
        .save-btn:focus svg polygon,
        .save-btn:focus svg polyline,
        .save-btn:focus svg line {
            filter: none !important;
            fill: #fff !important;
            stroke: none !important;
        }

        body.light-theme .save-btn {
            background: var(--bg-medium);
            color: var(--text-primary);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .save-btn:hover,
        .save-btn:focus {
            background: var(--accent);
            color: #fff;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        body.light-theme .save-btn:hover,
        body.light-theme .save-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: transparent;
        }

        .rect-preview {
            outline: 2px dashed var(--accent);
            outline-offset: -2px;
        }

        .rect-dash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Zoom functionality */
        .zoom-controls {
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .zoom-controls:hover {
            opacity: 1;
        }

        .zoom-btn {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        body.light-theme .zoom-btn {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn:hover {
            transform: translateY(-1px);
        }

        .tool-zoom .pixel-grid,
        .tool-zoom .pixel {
            cursor: url("icons/cursor/zoom-in-cursor.svg") 0 18, auto;
        }

        .tool-zoom.cmd-pressed .pixel-grid,
        .tool-zoom.cmd-pressed .pixel {
            cursor: url("icons/cursor/zoom-out-cursor.svg") 0 18, auto;
        }

        body.light-theme .panel-header {
            background-color: #f5f5f5;
            /* Slightly lighter than bg-medium */
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.light-theme .panel-header:hover {
            background-color: #f5f5f5;
            filter: brightness(0.95);
        }

        body.light-theme select {
            background-color: #f8f8f8;
            /* Slightly lighter than bg-medium */
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }

        /* Hand tool cursor styles */
        .tool-hand .pixel-grid,
        .tool-hand .pixel {
            cursor: url("icons/cursor/hand-cursor.svg") 0 18, auto;
        }

        .tool-hand.drag .pixel-grid,
        .tool-hand.drag .pixel {
            cursor: url("icons/cursor/hand-drag-cursor.svg") 0 18, auto;
        }

        /* Color Swatch Button */
        .color-swatch-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            overflow: hidden;
            position: relative;
        }

        .color-swatch {
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.2);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .color-swatch-btn:hover .color-swatch {
            transform: scale(1.05);
            box-shadow: inset 0 0 0 3px rgba(255, 255, 255, 0.4);
        }

        body.light-theme .color-swatch {
            box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.15);
        }

        body.light-theme .color-swatch-btn:hover .color-swatch {
            box-shadow: inset 0 0 0 3px rgba(0, 0, 0, 0.25);
        }

        /* Add swatch button hover effect */
        #add-swatch-btn:hover {
            border-color: var(--accent) !important;
            color: var(--accent) !important;
            transform: scale(1.05);
            transition: all 0.15s ease;
        }

        #help-swatch-btn:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            opacity: 1;
        }

        body.light-theme #help-swatch-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Update help icon styles */
        #help-swatch-btn img {
            filter: invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            opacity: 0.25;
        }

        #help-swatch-btn:hover img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
            opacity: 0.25;
        }

        body.light-theme #help-swatch-btn img {
            filter: invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
            opacity: 0.25;
        }

        body.light-theme #help-swatch-btn:hover img {
            filter: invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
            opacity: 0.25;
        }

        /* Drag and Drop styles for color swatches */
        .color.dragging {
            opacity: 0.7;
            transform: scale(0.95);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .color.drag-over {
            box-shadow: 0 0 0 2px var(--accent);
            transform: scale(1.05);
            transition: transform 0.1s ease;
        }

        /* Styles for dragging color swatch button */
        .color-swatch-btn.dragging .color-swatch {
            opacity: 0.7;
            transform: scale(0.95);
            box-shadow: 0 0 0 2px var(--accent);
        }

        /* Drag over styles for palette areas */
        #bw-row.drag-over,
        #color-picker.drag-over {
            background-color: rgba(var(--accent-rgb), 0.1);
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 0 2px var(--accent);
            transition: all 0.2s ease;
        }

        /* Styles for pixels during drag operations */
        .pixel.drag-over {
            box-shadow: inset 0 0 0 25px rgba(var(--accent-rgb), 0.3) !important;
            transition: all 0.1s ease;
        }

        .pixel.brush-preview {
            box-shadow: inset 0 0 0 25px rgba(var(--accent-rgb), var(--preview-opacity, 0.15)) !important;
            transition: all 0.2s ease;
        }

        /* Canvas drag and drop styles */
        .pixel-grid.drag-over {
            box-shadow: inset 0 0 0 3px var(--accent);
            transition: all 0.2s ease;
        }

        /* Prevent text selection during drag */
        .color-picker,
        .color {
            user-select: none;
        }

        /* Layers Panel Styles */
        .layer-item {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: 8px;
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            gap: 6px;
        }

        .layer-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.light-theme .layer-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .layer-item.active {
            border-color: var(--accent);
            background-color: rgba(var(--accent-rgb), 0.1);
        }

        .layer-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .layer-item.drag-over-top {
            border-top: 3px solid var(--accent);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .layer-item.drag-over-bottom {
            border-bottom: 3px solid var(--accent);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .layer-item.drag-over-middle {
            border: 3px dashed var(--accent);
        }

        /* Delete button drag-over styles */
        .delete-drop-zone.drag-over {
            background-color: rgba(234, 67, 53, 0.3) !important;
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(234, 67, 53, 0.2) !important;
        }

        .delete-drop-zone.drag-over img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(93%) saturate(4868%) hue-rotate(347deg) brightness(91%) contrast(88%) !important;
            animation: shake 0.3s ease-in-out infinite;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-2px);
            }

            75% {
                transform: translateX(2px);
            }
        }

        .layer-item.group {
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        body.light-theme .layer-item.group {
            border: 1px solid rgba(0, 0, 0, 0.15);
        }

        .layer-item.group::before {
            content: none;
        }

        .layer-item.group .layer-name {
            font-weight: 600;
        }

        .layer-item.child {
            margin-left: 20px;
            background-color: rgba(255, 255, 255, 0.03);
        }

        body.light-theme .layer-item.child {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .layer-item.child .layer-meta-row::before {
            content: none;
        }

        .indent-guides {
            display: inline-flex;
            flex: 0 0 auto;
            margin-right: 6px;
        }

        .indent-guide {
            width: 20px;
            height: 32px;
            border-left: 1px solid rgba(255, 255, 255, 0.08);
        }

        body.light-theme .indent-guide {
            border-left-color: rgba(0, 0, 0, 0.12);
        }


        .layer-main {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .layer-preview {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            margin-right: 8px;
            background-color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
            image-rendering: pixelated;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        body.light-theme .layer-preview {
            border-color: rgba(0, 0, 0, 0.2);
        }

        /* Groups: differentiate preview shape and border */
        .layer-item.group .layer-preview {
            border-radius: 4px;
            background-color: transparent;
            border-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.light-theme .layer-item.group .layer-preview {
            background-color: transparent;
            border-color: rgba(0, 0, 0, 0.2);
        }

        .layer-item.group .layer-preview svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
        }

        .layer-preview .delete-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(220, 53, 69, 0.9);
            border-radius: 4px;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .layer-preview:hover .delete-overlay {
            display: flex;
        }

        /* Ensure delete overlay X icon is white on red for groups */
        .layer-item.group .layer-preview .delete-overlay {
            background-color: rgba(220, 53, 69, 0.95);
        }

        .layer-item.group .layer-preview .delete-overlay svg {
            color: white;
            stroke: white;
        }

        .layer-item.group .layer-preview .delete-overlay svg line {
            stroke: white;
        }

        .layer-info {
            flex-grow: 1;
            min-width: 0;
            margin-right: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .layer-meta-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .layer-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0;
            cursor: text;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid transparent;
            background: transparent;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .layer-name:hover:not(.editing) {
            background-color: rgba(255, 255, 255, 0.08);
        }

        body.light-theme .layer-name:hover:not(.editing) {
            background-color: rgba(0, 0, 0, 0.08);
        }

        .layer-name.editing {
            border-color: var(--accent);
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }

        body.light-theme .layer-name.editing {
            background-color: var(--bg-light);
        }

        .layer-visibility-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            margin-right: 4px;
        }

        .layer-visibility-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.light-theme .layer-visibility-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .layer-item.hidden {
            opacity: 0.5;
        }

        .layer-item.hidden .layer-preview {
            opacity: 0.3;
        }

        /* Layer Drag Handle */
        .layer-drag-handle {
            cursor: grab;
            color: var(--text-secondary);
            margin-right: 4px;
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: all 0.15s ease;
        }

        .layer-drag-handle:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        body.light-theme .layer-drag-handle:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .layer-drag-handle:active {
            cursor: grabbing;
            transform: translateY(0);
        }

        .layer-drag-handle img {
            width: 10px;
            height: auto;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.15s ease;
        }

        .layer-drag-handle:hover img {
            filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme .layer-drag-handle img {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme .layer-drag-handle:hover img {
            filter: brightness(0) saturate(100%) invert(30%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Custom scrollbar for layers list */
        #layers-list::-webkit-scrollbar {
            width: 6px;
        }

        #layers-list::-webkit-scrollbar-track {
            background: var(--bg-dark);
            border-radius: 3px;
        }

        #layers-list::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 3px;
        }

        #layers-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }

        .layers-search {
            position: relative;
        }

        .layers-search input {
            padding-right: 32px !important;
        }

        .layers-search .search-clear-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%) scale(0.9);
            opacity: 0;
            pointer-events: none;
            background: none;
            border: none;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: opacity 150ms ease, transform 150ms ease, color 150ms ease;
        }

        .layers-search .search-clear-btn.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(-50%) scale(1);
        }

        .layers-search .search-clear-btn:hover,
        .layers-search .search-clear-btn:focus-visible {
            color: var(--text-primary);
        }

        /* Icon Filters for Theme Consistency */
        .icon-themed {
            filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .icon-themed {
            filter: brightness(0) saturate(100%) invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .icon-themed:hover {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .icon-themed:hover {
            filter: brightness(0) saturate(100%) invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
        }

        /* Panel Header Icons */
        .panel-header .expand-icon {
            width: 18px;
            height: 18px;
            transition: transform 0.2s ease;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .panel-header .expand-icon {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .panel-header.collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        /* Panel type icons */
        .panel-header .panel-icon {
            width: 16px;
            height: 16px;
            opacity: 0.5;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            cursor: grab;
            transition: opacity 0.2s ease, filter 0.2s ease;
        }

        body.light-theme .panel-header .panel-icon {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .panel-header .panel-icon:hover {
            opacity: 1;
            filter: brightness(0) saturate(100%) invert(47%) sepia(96%) saturate(1676%) hue-rotate(201deg) brightness(98%) contrast(92%);
        }

        body.light-theme .panel-header .panel-icon:hover {
            filter: brightness(0) saturate(100%) invert(47%) sepia(96%) saturate(1676%) hue-rotate(201deg) brightness(98%) contrast(92%);
        }

        .panel-header .panel-icon:active {
            cursor: grabbing;
        }

        .panel-header .panel-title {
            user-select: none;
        }

        .panel-header .panel-title:active {
            cursor: grabbing;
        }

        .panel.dragging {
            opacity: 0.5;
        }

        .panel.drag-over {
            border-top: 2px solid var(--accent);
        }

        .panel-button {
            transition: color 0.2s ease, background-color 0.2s ease;
            border-radius: 6px;
        }

        .panel-button:hover,
        .panel-button:focus-visible {
            color: var(--text-primary) !important;
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        body.light-theme .panel-button:hover,
        body.light-theme .panel-button:focus-visible {
            background-color: rgba(0, 0, 0, 0.08) !important;
        }



        /* Layer Drag Handle */
        .layer-drag-handle svg {
            width: 18px;
            height: 18px;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .layer-drag-handle svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Add Layer Button Hover Effect */
        #add-layer-btn {
            transition: all 0.2s ease;
            border-radius: var(--border-radius);
            position: relative;
        }

        #add-layer-btn:hover {
            background-color: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        #add-layer-btn:hover svg {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Export Button Icons */
        .save-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .save-btn svg {
            width: 18px;
            height: 18px;
        }

        button.primary {
            background-color: var(--accent);
            color: white;
        }

        button.primary:hover {
            background-color: var(--accent-hover);
        }

        button.danger {
            background-color: var(--danger);
            color: white;
        }

        button.danger:hover {
            background-color: var(--danger-hover);
        }

        button.success {
            background-color: var(--success);
            color: white;
        }

        button.success:hover {
            background-color: var(--success-hover);
        }

        button.warning {
            background-color: var(--warning);
            color: #333;
        }

        button.warning:hover {
            background-color: var(--warning-hover);
        }

        button.donate-btn {
            background-color: #ececec;
            color: var(--bg-dark);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #e0e0e0;
        }

        button.donate-btn:hover {
            background-color: var(--accent);
            color: #fff;
        }

        .donate-btn svg {
            width: 18px;
            height: 18px;
        }

        .donate-heart {
            fill: var(--accent);
            transition: fill 0.2s;
        }

        button.donate-btn:hover .donate-heart {
            fill: #fff;
        }

        select {
            background-color: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: var(--border-radius);
            font-size: 13px;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px;
            padding-right: 25px;
        }

        body.light-theme select {
            background-color: #f8f8f8;
            /* Slightly lighter than bg-medium */
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }

        select:hover {
            border-color: rgba(255, 255, 255, 0.3);
        }

        body.light-theme select:hover {
            border-color: rgba(0, 0, 0, 0.3);
        }

        body.light-theme input[type="number"] {
            border: 1px solid rgba(0, 0, 0, 0.2) !important;
        }

        body.light-theme input[type="number"]:hover {
            border-color: rgba(0, 0, 0, 0.3) !important;
        }

        /* Responsive adjustments */
        @media (max-width: 800px) {
            body {
                grid-template-columns: 50px 1fr;
            }

            .left-panels {
                width: 180px;
            }

            .color {
                width: 35px;
                height: 35px;
            }

            .pixel {
                width: 20px;
                height: 20px;
            }

            /* Single column toolbar layout */
            .sidebar {
                grid-template-columns: 1fr;
                padding: 12px 6px 96px 6px;
            }

            /* Smaller color swatch button */
            #color-swatch-btn {
                width: 48px !important;
                height: 48px !important;
                left: 6px !important;
            }
        }

        @media (max-width: 600px) {
            body {
                grid-template-columns: 50px 1fr;
                grid-template-rows: auto 1fr 30px;
                grid-template-areas:
                    "toolbar header"
                    "toolbar content"
                    "toolbar footer";
            }

            .header {
                flex-wrap: wrap;
                gap: 8px;
                padding: 8px 12px;
            }

            .app-title {
                width: 100%;
                text-align: center;
            }

            .header-controls {
                position: static;
                left: auto;
                top: auto;
                transform: none;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .sidebar {
                grid-template-columns: 1fr;
                flex-direction: column-reverse;
                align-items: center;
                padding: 15px 6px 72px 6px;
                border-right: 1px solid rgba(255, 255, 255, 0.1);
                border-bottom: none;
                height: 100% !important;
            }

            body.light-theme .sidebar {
                border-right: 1px solid rgba(0, 0, 0, 0.1);
                border-bottom: none;
            }

            /* Even smaller color swatch button for very narrow screens */
            #color-swatch-btn {
                width: 38px !important;
                height: 38px !important;
                left: 6px !important;
                bottom: 8px !important;
            }

            .tool {
                margin: 0 0 8px 0;
            }

            .theme-switch {
                margin-left: 0;
            }

            .content {
                flex-direction: column-reverse;
                gap: 12px;
            }

            .left-panels {
                width: 100%;
            }

            .canvas-container {
                width: 100%;
                max-width: 100%;
            }
        }

        .save-buttons-column {
            margin-top: 16px;
            display: flex;
            flex-direction: column-reverse;
            gap: 8px;
            align-items: stretch;
            min-width: 0;
            overflow: visible;
        }

        .save-btn {
            background: #3A3A3A;
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 1rem;
            padding: 12px 0;
            width: 100%;
            box-sizing: border-box;
            white-space: normal;
            word-break: break-word;
        }

        body.light-theme .save-btn {
            background: var(--bg-medium);
            color: var(--text-primary);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .save-btn:hover,
        .save-btn:focus {
            background: var(--accent);
            color: #fff;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        body.light-theme .save-btn:hover,
        body.light-theme .save-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: transparent;
        }

        .rect-preview {
            outline: 2px dashed var(--accent);
            outline-offset: -2px;
        }

        .rect-dash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Zoom functionality */
        .zoom-controls {
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .zoom-controls:hover {
            opacity: 1;
        }

        .zoom-btn {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        body.light-theme .zoom-btn {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn:hover {
            transform: translateY(-1px);
        }

        .tool-zoom .pixel-grid,
        .tool-zoom .pixel {
            cursor: url("icons/cursor/zoom-in-cursor.svg") 0 18, auto;
        }

        .tool-zoom.cmd-pressed .pixel-grid,
        .tool-zoom.cmd-pressed .pixel {
            cursor: url("icons/cursor/zoom-out-cursor.svg") 0 18, auto;
        }

        body.light-theme .panel-header {
            background-color: #f5f5f5;
            /* Slightly lighter than bg-medium */
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.light-theme .panel-header:hover {
            background-color: #f5f5f5;
            filter: brightness(0.95);
        }

        body.light-theme select {
            background-color: #f8f8f8;
            /* Slightly lighter than bg-medium */
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }

        /* Hand tool cursor styles */
        .tool-hand .pixel-grid,
        .tool-hand .pixel {
            cursor: url("icons/cursor/hand-cursor.svg") 0 18, auto;
        }

        .tool-hand.drag .pixel-grid,
        .tool-hand.drag .pixel {
            cursor: url("icons/cursor/hand-drag-cursor.svg") 0 18, auto;
        }

        /* Color Swatch Button */
        .color-swatch-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            overflow: hidden;
            position: relative;
        }

        .color-swatch {
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.2);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .color-swatch-btn:hover .color-swatch {
            transform: scale(1.05);
            box-shadow: inset 0 0 0 3px rgba(255, 255, 255, 0.4);
        }

        body.light-theme .color-swatch {
            box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.15);
        }

        body.light-theme .color-swatch-btn:hover .color-swatch {
            box-shadow: inset 0 0 0 3px rgba(0, 0, 0, 0.25);
        }

        /* Add swatch button hover effect */
        #add-swatch-btn:hover {
            border-color: var(--accent) !important;
            color: var(--accent) !important;
            transform: scale(1.05);
            transition: all 0.15s ease;
        }

        #help-swatch-btn:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            opacity: 1;
        }

        body.light-theme #help-swatch-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Update help icon styles */
        #help-swatch-btn img {
            filter: invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            opacity: 0.25;
        }

        #help-swatch-btn:hover img {
            filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
            opacity: 0.25;
        }

        body.light-theme #help-swatch-btn img {
            filter: invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
            opacity: 0.25;
        }

        body.light-theme #help-swatch-btn:hover img {
            filter: invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
            opacity: 0.25;
        }

        /* Drag and Drop styles for color swatches */
        .color.dragging {
            opacity: 0.7;
            transform: scale(0.95);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .color.drag-over {
            box-shadow: 0 0 0 2px var(--accent);
            transform: scale(1.05);
            transition: transform 0.1s ease;
        }

        /* Styles for dragging color swatch button */
        .color-swatch-btn.dragging .color-swatch {
            opacity: 0.7;
            transform: scale(0.95);
            box-shadow: 0 0 0 2px var(--accent);
        }

        /* Drag over styles for palette areas */
        #bw-row.drag-over,
        #color-picker.drag-over {
            background-color: rgba(var(--accent-rgb), 0.1);
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 0 2px var(--accent);
            transition: all 0.2s ease;
        }

        /* Styles for pixels during drag operations */
        .pixel.drag-over {
            box-shadow: inset 0 0 0 25px rgba(var(--accent-rgb), 0.3) !important;
            transition: all 0.1s ease;
        }

        /* Canvas drag and drop styles */
        .pixel-grid.drag-over {
            box-shadow: inset 0 0 0 3px var(--accent);
            transition: all 0.2s ease;
        }

        /* Prevent text selection during drag */
        .color-picker,
        .color {
            user-select: none;
        }

        /* Layers Panel Styles */
        .layer-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .layer-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.light-theme .layer-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .layer-item.active {
            border-color: var(--accent);
            background-color: rgba(var(--accent-rgb), 0.1);
        }

        .layer-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .layer-item.drag-over-top {
            border-top: 3px solid var(--accent);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .layer-item.drag-over-bottom {
            border-bottom: 3px solid var(--accent);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .layer-preview {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            margin-right: 8px;
            background-color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
            image-rendering: pixelated;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        body.light-theme .layer-preview {
            border-color: rgba(0, 0, 0, 0.2);
        }

        .layer-preview .delete-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(220, 53, 69, 0.9);
            border-radius: 4px;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .layer-preview:hover .delete-overlay {
            display: flex;
        }

        .layer-info {
            flex-grow: 1;
            min-width: 0;
            margin-right: 8px;
        }

        .layer-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
            cursor: text;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid transparent;
            background: transparent;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .layer-name.editing {
            border-color: var(--accent);
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }

        body.light-theme .layer-name.editing {
            background-color: var(--bg-light);
        }

        .layer-visibility-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            margin-right: 4px;
        }

        .layer-visibility-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.light-theme .layer-visibility-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .layer-item.hidden {
            opacity: 0.5;
        }

        .layer-item.hidden .layer-preview {
            opacity: 0.3;
        }

        /* Layer Drag Handle */
        .layer-drag-handle {
            cursor: grab;
            color: var(--text-secondary);
            margin-right: 4px;
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: all 0.15s ease;
        }

        .layer-drag-handle:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        body.light-theme .layer-drag-handle:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .layer-drag-handle:active {
            cursor: grabbing;
            transform: translateY(0);
        }

        .layer-drag-handle img {
            width: 10px;
            height: auto;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.15s ease;
        }

        .layer-drag-handle:hover img {
            filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme .layer-drag-handle img {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme .layer-drag-handle:hover img {
            filter: brightness(0) saturate(100%) invert(30%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Custom scrollbar for layers list */
        #layers-list::-webkit-scrollbar {
            width: 6px;
        }

        #layers-list::-webkit-scrollbar-track {
            background: var(--bg-dark);
            border-radius: 3px;
        }

        #layers-list::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 3px;
        }

        #layers-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }

        /* Icon Filters for Theme Consistency */
        .icon-themed {
            filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .icon-themed {
            filter: brightness(0) saturate(100%) invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .icon-themed:hover {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        body.light-theme .icon-themed:hover {
            filter: brightness(0) saturate(100%) invert(0%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(0%) contrast(100%);
        }

        /* Panel Header Icons */
        .panel-header .expand-icon {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            transition: transform 0.2s ease;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .panel-header .expand-icon {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .panel-header.collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        /* Layer Drag Handle */
        .layer-drag-handle svg {
            width: 18px;
            height: 18px;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .layer-drag-handle svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Add Layer Button Hover Effect */
        #add-layer-btn {
            transition: all 0.2s ease;
            border-radius: var(--border-radius);
            position: relative;
        }

        #add-layer-btn:hover {
            background-color: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        #add-layer-btn:hover svg {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Export Button Icons */
        .save-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .save-btn svg {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            width: 18px;
            height: 18px;
            transition: filter 0.2s ease;
        }

        body.light-theme .save-btn svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        .save-btn:hover svg {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* FINAL OVERRIDE: ensure white icons/text on Save/Load in Light Mode (wins cascade) */
        body.light-theme #save-project-panel-btn:hover,
        body.light-theme #save-project-panel-btn:focus,
        body.light-theme #load-project-panel-btn:hover,
        body.light-theme #load-project-panel-btn:focus,
        body.light-theme #save-project-btn:hover,
        body.light-theme #save-project-btn:focus,
        body.light-theme #load-project-btn:hover,
        body.light-theme #load-project-btn:focus {
            color: #ffffff !important;
        }

        body.light-theme #save-project-panel-btn:hover svg,
        body.light-theme #save-project-panel-btn:focus svg,
        body.light-theme #save-project-panel-btn:hover svg *,
        body.light-theme #save-project-panel-btn:focus svg *,
        body.light-theme #load-project-panel-btn:hover svg,
        body.light-theme #load-project-panel-btn:focus svg,
        body.light-theme #load-project-panel-btn:hover svg *,
        body.light-theme #load-project-panel-btn:focus svg *,
        body.light-theme #save-project-btn:hover svg,
        body.light-theme #save-project-btn:focus svg,
        body.light-theme #save-project-btn:hover svg *,
        body.light-theme #save-project-btn:focus svg *,
        body.light-theme #load-project-btn:hover svg,
        body.light-theme #load-project-btn:focus svg,
        body.light-theme #load-project-btn:hover svg *,
        body.light-theme #load-project-btn:focus svg * {
            filter: none !important;
            fill: #ffffff !important;
            stroke: none !important;
        }

        /* Add Layer Button Image Styling */
        #add-layer-btn img {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme #add-layer-btn img {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        #add-layer-btn:hover img {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Add Layer and Add Image Layer Button Hover Effects */
        #add-layer-btn,
        #add-image-layer-btn {
            transition: all 0.2s ease;
            border-radius: 6px;
            position: relative;
        }

        #add-layer-btn:hover,
        #add-image-layer-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        body.light-theme #add-layer-btn:hover,
        body.light-theme #add-image-layer-btn:hover {
            background-color: rgba(0, 0, 0, 0.08);
        }

        #add-layer-btn img,
        #add-image-layer-btn img {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme #add-layer-btn img,
        body.light-theme #add-image-layer-btn img {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        body.light-theme #add-layer-btn:hover img,
        body.light-theme #add-image-layer-btn:hover img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(96%) saturate(1706%) hue-rotate(213deg) brightness(97%) contrast(94%);
        }

        #add-layer-btn:hover img,
        #add-image-layer-btn:hover img {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        .panel-header.collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        /* Layer Drag Handle */
        .layer-drag-handle svg {
            width: 18px;
            height: 18px;
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        }

        body.light-theme .layer-drag-handle svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Add Layer Button Hover Effect */
        #add-layer-btn {
            transition: all 0.2s ease;
            border-radius: var(--border-radius);
        }

        #add-layer-btn:hover {
            background-color: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme #add-layer-btn svg {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        #add-layer-btn:hover svg {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Export Button Icons */

        /* Layer Lock Button */
        .layer-lock-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            margin-right: 4px;
        }

        .layer-lock-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.light-theme .layer-lock-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .layer-lock-btn.locked {
            color: var(--warning);
        }

        .layer-lock-btn:not(.locked) {
            opacity: 0.3;
        }

        .layer-item.locked {
            opacity: 0.7;
        }

        /* Container for visibility and lock buttons arranged vertically */
        .layer-controls {
            display: flex;
            flex-direction: column-reverse;
            gap: 0px;
            margin-right: 4px;
        }

        .layer-controls .layer-visibility-btn,
        .layer-controls .layer-lock-btn {
            margin-right: 0;
        }

        .layer-effects-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.08em;
            padding: 4px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            transition: all 0.2s ease;
            margin-left: auto;
            padding-left: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .layer-effects-btn:hover,
        .layer-effects-btn:focus-visible,
        .layer-item.effects-expanded .layer-effects-btn {
            color: var(--accent);
            background-color: rgba(var(--accent-rgb), 0.12);
        }

        /* Group expand button specific styles - match lock/eye button size */
        .group-expand-btn {
            padding: 2px !important;
            width: 18px !important;
            height: 18px !important;
            min-width: 18px;
            justify-content: center;
            margin-left: auto !important;
            padding-left: 2px !important;
        }

        .group-expand-btn svg {
            display: block;
            margin: 0 auto;
            width: 10px;
            height: 10px;
        }

        .layer-effects-list {
            display: none;
            flex-direction: column;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            padding-left: 0;
            padding-bottom: 4px;
            margin-left: 0;
            border-left: none;
            width: 100%;
        }

        body.light-theme .layer-effects-list {
            border-left: none;
        }

        .layer-item.effects-expanded .layer-effects-list {
            display: flex;
        }

        .layer-effects-list-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .layer-effects-list-item.disabled {
            opacity: 0.55;
        }

        .effect-visibility-btn {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            padding: 2px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
        }

        .effect-visibility-btn:hover,
        .effect-visibility-btn:focus-visible {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.light-theme .effect-visibility-btn:hover,
        body.light-theme .effect-visibility-btn:focus-visible {
            background-color: rgba(0, 0, 0, 0.08);
        }

        .layer-item.active .effect-visibility-btn {
            background-color: rgba(var(--accent-rgb), 0.1);
            color: var(--text-primary);
        }

        .layer-item.active .effect-visibility-btn:hover,
        .layer-item.active .effect-visibility-btn:focus-visible {
            background-color: rgba(var(--accent-rgb), 0.16);
        }

        .layer-effects-list-label {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            text-align: left;
        }

        .layer-effects-list-value {
            color: var(--text-secondary);
            text-align: right;
            min-width: 48px;
        }

        /* Override canvas drag-over styles with dashed border */
        .pixel-grid.drag-over {
            border: 2px dashed rgba(var(--accent-rgb), 0.6) !important;
            border-radius: var(--border-radius) !important;
            box-shadow: none !important;
        }

        /* Updated Add Layer and Add Image Layer Button Hover Effects */
        #add-layer-btn,
        #add-image-layer-btn {
            transition: all 0.2s ease !important;
            border-radius: 6px !important;
            position: relative !important;
            width: 24px !important;
            height: 24px !important;
            min-width: 24px !important;
            min-height: 24px !important;
            padding: 0 !important;
            margin: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-sizing: border-box !important;
        }

        #add-layer-btn:hover,
        #add-image-layer-btn:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.light-theme #add-layer-btn:hover,
        body.light-theme #add-image-layer-btn:hover {
            background-color: rgba(0, 0, 0, 0.08) !important;
        }



        /* Layers Panel Footer - Override Everything */
        .panel-footer {
            display: flex !important;
            padding: 4px !important;
            gap: 2px !important;
            border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
            background-color: var(--bg-medium) !important;
        }

        body.light-theme .panel-footer {
            border-top-color: rgba(0, 0, 0, 0.1) !important;
        }

        .panel-footer #add-layer-btn,
        .panel-footer #add-group-btn,
        .panel-footer #duplicate-layer-btn,
        .panel-footer #add-image-layer-btn,
        .panel-footer #delete-layer-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #add-layer-btn:hover,
        .panel-footer #add-group-btn:hover,
        .panel-footer #duplicate-layer-btn:hover,
        .panel-footer #add-image-layer-btn:hover {
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        .panel-footer #delete-layer-btn:hover {
            background-color: rgba(234, 67, 53, 0.25) !important;
        }

        body.light-theme .panel-footer #add-layer-btn:hover,
        body.light-theme .panel-footer #add-group-btn:hover,
        body.light-theme .panel-footer #duplicate-layer-btn:hover,
        body.light-theme .panel-footer #add-image-layer-btn:hover {
            background-color: rgba(0, 0, 0, 0.06) !important;
        }

        body.light-theme .panel-footer #delete-layer-btn:hover {
            background-color: rgba(234, 67, 53, 0.2) !important;
        }

        .panel-footer #add-layer-btn img,
        .panel-footer #add-group-btn img,
        .panel-footer #duplicate-layer-btn img,
        .panel-footer #add-image-layer-btn img,
        .panel-footer #delete-layer-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #add-layer-btn img,
        body.light-theme .panel-footer #add-group-btn img,
        body.light-theme .panel-footer #duplicate-layer-btn img,
        body.light-theme .panel-footer #add-image-layer-btn img,
        body.light-theme .panel-footer #delete-layer-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #add-layer-btn:hover img,
        .panel-footer #add-group-btn:hover img,
        .panel-footer #duplicate-layer-btn:hover img,
        .panel-footer #add-image-layer-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        .panel-footer #delete-layer-btn:hover img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(93%) saturate(4868%) hue-rotate(347deg) brightness(91%) contrast(88%) !important;
        }

        body.light-theme .panel-footer #add-layer-btn:hover img,
        body.light-theme .panel-footer #add-group-btn:hover img,
        body.light-theme .panel-footer #duplicate-layer-btn:hover img,
        body.light-theme .panel-footer #add-image-layer-btn:hover img {
            filter: brightness(0) invert(20%) !important;
        }

        body.light-theme .panel-footer #delete-layer-btn:hover img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(93%) saturate(4868%) hue-rotate(347deg) brightness(91%) contrast(88%) !important;
        }

        /* Reset Effects Button in Live Effects Footer */
        .panel-footer #reset-effects-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #reset-effects-btn:hover {
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        body.light-theme .panel-footer #reset-effects-btn:hover {
            background-color: rgba(0, 0, 0, 0.06) !important;
        }

        .panel-footer #reset-effects-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #reset-effects-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #reset-effects-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        body.light-theme .panel-footer #reset-effects-btn:hover img {
            filter: brightness(0) invert(20%) !important;
        }

        /* Random Seed Button in Live Effects Footer */
        .panel-footer #random-seed-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #random-seed-btn:hover {
            background-color: rgba(255, 255, 255, 0.08) !important;
        }

        body.light-theme .panel-footer #random-seed-btn:hover {
            background-color: rgba(0, 0, 0, 0.06) !important;
        }

        .panel-footer #random-seed-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #random-seed-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #random-seed-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        body.light-theme .panel-footer #random-seed-btn:hover img {
            filter: brightness(0) invert(20%) !important;
        }

        /* Add Swatch Button in Color Palette Footer */
        .panel-footer #add-swatch-footer-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #add-swatch-footer-btn:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.light-theme .panel-footer #add-swatch-footer-btn:hover {
            background-color: rgba(0, 0, 0, 0.05) !important;
        }

        .panel-footer #add-swatch-footer-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #add-swatch-footer-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #add-swatch-footer-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        body.light-theme .panel-footer #add-swatch-footer-btn:hover img {
            filter: brightness(0) invert(0%) !important;
        }

        /* Duplicate Swatch Button in Color Palette Footer */
        .panel-footer #duplicate-swatch-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #duplicate-swatch-btn:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.light-theme .panel-footer #duplicate-swatch-btn:hover {
            background-color: rgba(0, 0, 0, 0.05) !important;
        }

        .panel-footer #duplicate-swatch-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #duplicate-swatch-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #duplicate-swatch-btn:hover img {
            filter: brightness(0) invert(100%) !important;
        }

        body.light-theme .panel-footer #duplicate-swatch-btn:hover img {
            filter: brightness(0) invert(0%) !important;
        }

        /* Delete Swatch Button in Color Palette Footer */
        .panel-footer #delete-swatch-btn {
            flex: 1 1 0px !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: none !important;
            height: 36px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: background-color 0.15s !important;
            box-sizing: border-box !important;
            outline: none !important;
            transform: none !important;
        }

        .panel-footer #delete-swatch-btn:hover {
            background-color: rgba(234, 67, 53, 0.25) !important;
        }

        body.light-theme .panel-footer #delete-swatch-btn:hover {
            background-color: rgba(234, 67, 53, 0.2) !important;
        }

        .panel-footer #delete-swatch-btn img {
            width: 20px !important;
            height: 20px !important;
            display: block !important;
            filter: brightness(0) invert(60%) !important;
        }

        body.light-theme .panel-footer #delete-swatch-btn img {
            filter: brightness(0) invert(40%) !important;
        }

        .panel-footer #delete-swatch-btn:hover img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(93%) saturate(4868%) hue-rotate(347deg) brightness(91%) contrast(88%) !important;
        }

        body.light-theme .panel-footer #delete-swatch-btn:hover img {
            filter: brightness(0) saturate(100%) invert(27%) sepia(93%) saturate(4868%) hue-rotate(347deg) brightness(91%) contrast(88%) !important;
        }

        /* Folder icons in layer preview */
        .layer-item.group .layer-preview img {
            filter: brightness(0) saturate(100%) invert(60%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
            transition: filter 0.2s ease;
        }

        body.light-theme .layer-item.group .layer-preview img {
            filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(90%);
        }

        /* Color swatch button styling - pinned to bottom */
        #color-swatch-btn {
            z-index: 10;
        }

        /* Patreon support button */
        .patreon-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background-color: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .patreon-button:hover {
            background-color: var(--accent-hover);
        }

        .patreon-button:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body>
    <header class="header">
        <h1 class="app-title">
            PixelDraw
            <span class="version-tooltip">0.9.5</span>
        </h1>
        <div class="header-controls">
            <div id="fill-pattern-control" class="control-row" style="display: none; margin-right: 12px;">
                <label for="fill-pattern-select" class="control-label">Pattern:</label>
                <select id="fill-pattern-select" title="Pattern">
                    <option value="solid">Solid</option>
                    <option value="checkerboard">Checkerboard</option>
                    <option value="vertical">Vertical Lines</option>
                    <option value="horizontal">Horizontal Lines</option>
                    <option value="diagonal-right">Diagonal Lines (\)</option>
                    <option value="diagonal-left">Diagonal Lines (/)</option>
                    <option value="grid">Grid</option>
                    <option value="dot">Dot</option>
                    <option value="random">Random</option>
                    <option value="cross">Cross</option>
                    <option value="brick">Brick</option>
                </select>
            </div>
            <div id="opacity-control" style="display: none;">
                <label for="opacity-slider">Opacity:</label>
                <div class="opacity-slider-wrapper">
                    <input type="range" id="opacity-slider" min="0" max="100" value="100" step="1" title="Opacity">
                </div>
                <span id="opacity-value" class="opacity-value-editable" title="Opacity Value">100%</span>
            </div>
            <div id="brush-size-control" style="display: none;">
                <label for="brush-size-slider">Brush:</label>
                <div class="opacity-slider-wrapper">
                    <input type="range" id="brush-size-slider" min="1" max="32" value="1" step="1" title="Brush Size">
                </div>
                <span id="brush-size-value" class="opacity-value-editable" title="Brush Size Value">1</span>
            </div>
        </div>
        <a href="https://www.patreon.com/c/samolevsky/membership" target="_blank" rel="noopener noreferrer"
            class="patreon-button" title="Support PixelDraw Development">
            <svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 18 18" width="18">
                <path fill="currentColor"
                    d="M12.182,3.2545A4.00649,4.00649,0,0,0,9,5.1635a4.00649,4.00649,0,0,0-3.182-1.909A3.818,3.818,0,0,0,2,7.0725c0,3.646,7,8.273,7,8.273s7-4.578,7-8.273A3.818,3.818,0,0,0,12.182,3.2545Z" />
            </svg>
            <span>Support App Development</span>
        </a>
        <div class="header-actions">
            <label class="theme-switch" title="Theme">
                <input type="checkbox" id="theme-toggle">
                <span class="theme-slider">
                    <span class="icon moon-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </span>
                    <span class="icon sun-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </span>
                </span>
            </label>
        </div>
    </header>

    <a href="https://samolevsky.com/" target="_blank" rel="noopener noreferrer" tabindex="0"
        aria-label="Visit samolevsky.com" style="position: absolute; top: 9px; left: 20px; z-index: 1000;">
        <div class="app-icon">
            <img src="icons/app-icon-dark.svg" alt="PixelDraw Logo" width="32" height="32">
        </div>
    </a>

    <aside class="sidebar">
        <div id="draw-btn" class="tool active" title="Draw (D)">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18" fill="none">
                <path
                    d="M10.227,4,2.542,11.686a.496.496,0,0,0-.1255.2105L1.0275,16.55c-.057.188.2295.425.3915.425a.15587.15587,0,0,0,.031-.003c.138-.032,3.9335-1.172,4.6555-1.389a.492.492,0,0,0,.2075-.125L14,7.772ZM5.7,14.658c-1.0805.3245-2.431.7325-3.3645,1.011L3.34,12.304Z"
                    fill="currentColor" />
                <path
                    d="M16.7835,4.1,13.9,1.216a.60751.60751,0,0,0-.433-.1765H13.45a.686.686,0,0,0-.4635.2035l-2.05,2.05L14.708,7.0645l2.05-2.05a.686.686,0,0,0,.2-.4415A.612.612,0,0,0,16.7835,4.1Z"
                    fill="currentColor" />
            </svg>
        </div>
        <div id="brush-btn" class="tool" title="Brush (B)">
            <img src="icons/tool/brush-tool.svg" alt="Brush">
        </div>
        <div class="tool-group">
            <div id="erase-tool-btn" class="tool" title="Erase Tool (E)">
                <div class="tool-icon-wrapper">
                    <img id="erase-tool-icon" src="icons/tool/erase-tool.svg" alt="Erase Tool">
                    <div class="tool-dropdown-indicator">
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 2L3 4L5 2" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
            <div id="erase-tool-dropdown" class="tool-dropdown">
                <div id="erase-btn" class="tool-dropdown-item active" data-tool="erase" title="Erase (E)">
                    <img src="icons/tool/erase-tool.svg" alt="Erase" style="width: 16px; height: 16px;">
                    <span>Erase</span>
                </div>
                <div id="clear-btn" class="tool-dropdown-item" data-tool="clear" title="Clear (X)">
                    <img src="icons/tool/clear-tool.svg" alt="Clear Layer" style="width: 16px; height: 16px;">
                    <span>Clear</span>
                </div>
            </div>
        </div>
        <div class="tool-group">
            <div id="select-tool-btn" class="tool" title="Marquee Tool (M)">
                <div class="tool-icon-wrapper">
                    <img id="select-tool-icon" src="icons/tool/selection-rectangle.svg" alt="Marquee Tool"
                        style="width: 18px; height: 18px;">
                    <div class="tool-dropdown-indicator">
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 2L3 4L5 2" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
            <div id="select-tool-dropdown" class="tool-dropdown">
                <div id="rect-select-btn" class="tool-dropdown-item active" data-tool="rect-select"
                    title="Rectangular Marquee Tool (M)">
                    <img src="icons/tool/selection-rectangle.svg" alt="Rectangular Marquee Tool"
                        style="width: 16px; height: 16px;">
                    <span>Rectangular Marquee</span>
                </div>
                <div id="ellipse-select-btn" class="tool-dropdown-item" data-tool="ellipse-select"
                    title="Elliptical Marquee Tool">
                    <img src="icons/tool/select-circular.svg" alt="Elliptical Marquee Tool"
                        style="width: 16px; height: 16px;">
                    <span>Elliptical Marquee</span>
                </div>
                <div id="move-select-btn" class="tool-dropdown-item" data-tool="move-select"
                    title="Move Selection Tool">
                    <img src="icons/tool/selection-move.svg" alt="Move Selection Tool"
                        style="width: 16px; height: 16px;">
                    <span>Move Selection</span>
                </div>
            </div>
        </div>
        <div class="tool-group">
            <div id="shape-tool-btn" class="tool" title="Shape Tool (R/O)">
                <div class="tool-icon-wrapper">
                    <svg id="shape-tool-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_685_45)">
                            <path
                                d="M1 2.5V15.5C1 15.63 1.05 15.76 1.15 15.85C1.24 15.94 1.37 16 1.5 16H16.5C16.63 16 16.76 15.95 16.85 15.85C16.94 15.76 17 15.63 17 15.5V2.5C17 2.37 16.95 2.24 16.85 2.15C16.76 2.06 16.63 2 16.5 2H1.5C1.37 2 1.24 2.05 1.15 2.15C1.06 2.24 1 2.37 1 2.5Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_685_45">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <div class="tool-dropdown-indicator">
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 2L3 4L5 2" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
            <div id="shape-tool-dropdown" class="tool-dropdown">
                <div id="rectangle-btn" class="tool-dropdown-item active" data-tool="rectangle" title="Rectangle (R)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_685_45_rect)">
                            <path
                                d="M1 2.5V15.5C1 15.63 1.05 15.76 1.15 15.85C1.24 15.94 1.37 16 1.5 16H16.5C16.63 16 16.76 15.95 16.85 15.85C16.94 15.76 17 15.63 17 15.5V2.5C17 2.37 16.95 2.24 16.85 2.15C16.76 2.06 16.63 2 16.5 2H1.5C1.37 2 1.24 2.05 1.15 2.15C1.06 2.24 1 2.37 1 2.5Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_685_45_rect">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <span>Rectangle</span>
                </div>
                <div id="ellipse-btn" class="tool-dropdown-item" data-tool="ellipse" title="Ellipse (O)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_685_42_ellipse)">
                            <path
                                d="M9 2.075C4.057 2.075 0.0500031 5.1755 0.0500031 9C0.0500031 12.8245 4.057 15.925 9 15.925C13.943 15.925 17.95 12.8245 17.95 9C17.95 5.1755 13.943 2.075 9 2.075Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_685_42_ellipse">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <span>Circle</span>
                </div>
            </div>
        </div>
        <div id="line-btn" class="tool" title="Line (L)">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 16L16 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
        </div>
        <div class="tool-group">
            <div id="nav-tool-btn" class="tool" title="Navigation Tool (H/Z)">
                <div class="tool-icon-wrapper">
                    <svg id="nav-tool-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_689_2)">
                            <path
                                d="M17.055 4.8785C16.7586 4.82823 16.4539 4.87916 16.19 5.0231C15.9261 5.16703 15.7182 5.3956 15.6 5.672L13.9665 8.196C13.8475 8.436 13.5415 8.6595 13.324 8.565C13.1065 8.4705 13.0465 8.215 13.1565 7.8095L13.942 3.1965C13.9873 3.02909 13.9954 2.85381 13.9659 2.68292C13.9363 2.51203 13.8699 2.34965 13.771 2.20712C13.6722 2.0646 13.5435 1.94538 13.3938 1.85779C13.2441 1.77019 13.0771 1.71634 12.9045 1.7C12.6152 1.68118 12.3284 1.76481 12.0946 1.93623C11.8607 2.10765 11.6946 2.35591 11.6255 2.6375L10.8755 6.9375C10.8755 6.9375 10.821 7.496 10.3755 7.477C9.93 7.458 9.9785 6.8865 9.9785 6.8865V1.857C9.98497 1.54133 9.86577 1.23601 9.64713 1.00822C9.42849 0.780429 9.12832 0.648821 8.81265 0.64235C8.49697 0.635879 8.19166 0.755073 7.96387 0.973713C7.73607 1.19235 7.60447 1.49253 7.598 1.8082C7.59767 1.82446 7.59767 1.84073 7.598 1.857V6.8675C7.598 7.182 7.1195 7.174 7.0305 6.9175C6.621 5.723 5.7205 3.0205 5.7205 3.0205C5.63369 2.74418 5.45253 2.50716 5.20868 2.35087C4.96484 2.19458 4.67382 2.12897 4.3865 2.1655C4.2156 2.19334 4.05282 2.2581 3.9095 2.35526C3.76618 2.45242 3.64576 2.57965 3.55662 2.72809C3.46748 2.87653 3.41176 3.04262 3.39335 3.21478C3.37493 3.38695 3.39426 3.56106 3.45 3.725L5.072 8.442C5.13941 8.65104 5.18958 8.86526 5.222 9.0825C5.27415 9.28827 5.25892 9.50533 5.17855 9.7018C5.09818 9.89827 4.95691 10.0638 4.7755 10.174C4.544 10.3065 2.3335 8.6145 2.156 8.535C1.121 7.935 0.468496 8.189 0.184496 8.526C-0.143004 8.914 0.0844962 9.551 0.557996 10.042L4.0415 13.9965C4.24995 14.2339 4.43686 14.4894 4.6 14.76C4.84 15.1769 5.11428 15.5731 5.42 15.9445C5.90887 16.4371 6.49965 16.8167 7.15085 17.0566C7.80205 17.2966 8.49789 17.3911 9.1895 17.3335C11.4055 17.3335 13.0495 16.4865 13.634 15.1115C14.0305 13.9615 14.4065 12.4075 14.5865 11.867C14.704 11.514 17.5865 6.454 17.5865 6.454C17.6798 6.32159 17.7406 6.16904 17.7639 6.00872C17.7872 5.84841 17.7724 5.68486 17.7206 5.53135C17.6688 5.37785 17.5816 5.23873 17.4659 5.1253C17.3503 5.01186 17.2095 4.9273 17.055 4.8785Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_689_2">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <div class="tool-dropdown-indicator">
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 2L3 4L5 2" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                </div>
            </div>
            <div id="nav-tool-dropdown" class="tool-dropdown">
                <div id="hand-btn" class="tool-dropdown-item active" data-tool="hand" title="Hand (H)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_689_2_hand)">
                            <path
                                d="M17.055 4.8785C16.7586 4.82823 16.4539 4.87916 16.19 5.0231C15.9261 5.16703 15.7182 5.3956 15.6 5.672L13.9665 8.196C13.8475 8.436 13.5415 8.6595 13.324 8.565C13.1065 8.4705 13.0465 8.215 13.1565 7.8095L13.942 3.1965C13.9873 3.02909 13.9954 2.85381 13.9659 2.68292C13.9363 2.51203 13.8699 2.34965 13.771 2.20712C13.6722 2.0646 13.5435 1.94538 13.3938 1.85779C13.2441 1.77019 13.0771 1.71634 12.9045 1.7C12.6152 1.68118 12.3284 1.76481 12.0946 1.93623C11.8607 2.10765 11.6946 2.35591 11.6255 2.6375L10.8755 6.9375C10.8755 6.9375 10.821 7.496 10.3755 7.477C9.93 7.458 9.9785 6.8865 9.9785 6.8865V1.857C9.98497 1.54133 9.86577 1.23601 9.64713 1.00822C9.42849 0.780429 9.12832 0.648821 8.81265 0.64235C8.49697 0.635879 8.19166 0.755073 7.96387 0.973713C7.73607 1.19235 7.60447 1.49253 7.598 1.8082C7.59767 1.82446 7.59767 1.84073 7.598 1.857V6.8675C7.598 7.182 7.1195 7.174 7.0305 6.9175C6.621 5.723 5.7205 3.0205 5.7205 3.0205C5.63369 2.74418 5.45253 2.50716 5.20868 2.35087C4.96484 2.19458 4.67382 2.12897 4.3865 2.1655C4.2156 2.19334 4.05282 2.2581 3.9095 2.35526C3.76618 2.45242 3.64576 2.57965 3.55662 2.72809C3.46748 2.87653 3.41176 3.04262 3.39335 3.21478C3.37493 3.38695 3.39426 3.56106 3.45 3.725L5.072 8.442C5.13941 8.65104 5.18958 8.86526 5.222 9.0825C5.27415 9.28827 5.25892 9.50533 5.17855 9.7018C5.09818 9.89827 4.95691 10.0638 4.7755 10.174C4.544 10.3065 2.3335 8.6145 2.156 8.535C1.121 7.935 0.468496 8.189 0.184496 8.526C-0.143004 8.914 0.0844962 9.551 0.557996 10.042L4.0415 13.9965C4.24995 14.2339 4.43686 14.4894 4.6 14.76C4.84 15.1769 5.11428 15.5731 5.42 15.9445C5.90887 16.4371 6.49965 16.8167 7.15085 17.0566C7.80205 17.2966 8.49789 17.3911 9.1895 17.3335C11.4055 17.3335 13.0495 16.4865 13.634 15.1115C14.0305 13.9615 14.4065 12.4075 14.5865 11.867C14.704 11.514 17.5865 6.454 17.5865 6.454C17.6798 6.32159 17.7406 6.16904 17.7639 6.00872C17.7872 5.84841 17.7724 5.68486 17.7206 5.53135C17.6688 5.37785 17.5816 5.23873 17.4659 5.1253C17.3503 5.01186 17.2095 4.9273 17.055 4.8785Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_689_2_hand">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <span>Hand</span>
                </div>
                <div id="zoom-btn" class="tool-dropdown-item" data-tool="zoom" title="Zoom (Z)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_685_34_zoom)">
                            <path
                                d="M17.587 16.1075L13.628 12.15C14.6788 10.7258 15.1525 8.95707 14.9541 7.19832C14.7557 5.43958 13.8999 3.82082 12.5582 2.66653C11.2165 1.51224 9.48807 0.907735 7.71941 0.974192C5.95076 1.04065 4.27259 1.77316 3.02129 3.02488C1.76999 4.2766 1.03805 5.95502 0.972194 7.72369C0.906335 9.49237 1.51142 11.2206 2.66617 12.5619C3.82091 13.9032 5.43996 14.7585 7.19877 14.9563C8.95759 15.1541 10.7262 14.6798 12.15 13.6285L16.108 17.5865C16.3093 17.7547 16.5661 17.8414 16.8281 17.8297C17.0901 17.818 17.3383 17.7087 17.5237 17.5232C17.7092 17.3378 17.8185 17.0896 17.8302 16.8276C17.8419 16.5656 17.7552 16.3088 17.587 16.1075ZM3 8C3 7.01109 3.29324 6.04439 3.84265 5.22215C4.39206 4.3999 5.17295 3.75904 6.08658 3.3806C7.00021 3.00216 8.00555 2.90315 8.97545 3.09607C9.94536 3.289 10.8363 3.7652 11.5355 4.46447C12.2348 5.16373 12.711 6.05464 12.9039 7.02455C13.0969 7.99445 12.9978 8.99979 12.6194 9.91342C12.241 10.827 11.6001 11.6079 10.7779 12.1573C9.95561 12.7068 8.98891 13 8 13C6.67392 13 5.40215 12.4732 4.46447 11.5355C3.52678 10.5979 3 9.32608 3 8Z"
                                fill="currentColor" />
                        </g>
                        <defs>
                            <clipPath id="clip0_685_34_zoom">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                    <span>Zoom</span>
                </div>
            </div>
        </div>
        <div id="move-btn" class="tool" title="Move (M)">
            <img src="icons/tool/move.svg" alt="Move Tool">
        </div>
        <div id="fill-btn" class="tool" title="Fill (F)">
            <img src="icons/tool/fill-tool.svg" alt="Fill">
        </div>
        <div id="eyedropper-btn" class="tool" title="Eyedropper (I)">
            <img src="icons/tool/eyedropper-tool-3.svg" alt="Eyedropper">
        </div>
        <div id="crop-btn" class="tool" title="Crop (C)">
            <img src="icons/tool/crop-tool.svg" alt="Crop" width="18" height="18">
        </div>
        <div id="undo-btn" class="tool" title="Undo (Z)">
            <img src="icons/tool/undo-tool.svg" alt="Undo">
        </div>
        <div id="redo-btn" class="tool" title="Redo (Y)">
            <img src="icons/tool/redo-tool.svg" alt="Redo">
        </div>
        <button id="save-project-btn" class="tool" title="Save">
            <img src="icons/tool/save-tool.svg" alt="Save Project">
        </button>
        <button id="load-project-btn" class="tool" title="Load">
            <img src="icons/tool/load-tool.svg" alt="Load Project">
        </button>
        <button id="color-swatch-btn" class="tool color-swatch-btn" title="Color Picker"
            style="position: absolute; bottom: 12px; left: 9px; width: 72px; height: 72px; margin: 0;">
            <div class="color-swatch"></div>
        </button>
    </aside>

    <main class="content">
        <div class="left-panels">
            <div class="panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-color-palette.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Color Palette</span>
                    </span>
                    <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6225_465)">
                            <path
                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                fill="black" />
                        </g>
                        <defs>
                            <clipPath id="clip0_6225_465">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <div class="panel-content palette-content">
                    <div class="control-row" style="margin-bottom:8px;">
                        <label for="palette-select" class="control-label">Palette:</label>
                        <select id="palette-select" title="Palette"
                            style="flex:1 1 auto;width:100%;min-width:0;"></select>
                    </div>
                    <div id="bw-row"
                        style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:8px;">
                        <div id="add-swatch-btn" class="color"
                            style="display:flex;align-items:center;justify-content:center;cursor:pointer;background-color:transparent;border:1px dashed var(--text-secondary);color:var(--text-secondary);"
                            title="Add Color">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </div>
                    </div>
                    <div class="color-picker" id="color-picker"></div>
                </div>
                <div class="panel-footer">
                    <button id="add-swatch-footer-btn" title="Add Swatch"><img src="icons/ui/plus.svg"
                            alt="Add Color"></button>
                    <button id="duplicate-swatch-btn" title="Duplicate Swatch"><img src="icons/ui/duplicate.svg"
                            alt="Duplicate"></button>
                    <button id="delete-swatch-btn" title="Delete Swatch" class="delete-drop-zone"><img
                            src="icons/ui/delete.svg" alt="Delete"></button>
                    <button id="palette-view-toggle-btn" title="Toggle View"><img src="icons/ui/view-list.svg"
                            alt="Toggle View"></button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-layers.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Layers</span>
                    </span>
                    <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6225_465)">
                            <path
                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                fill="black" />
                        </g>
                        <defs>
                            <clipPath id="clip0_6225_465">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <div class="panel-content">
                    <div class="layers-search" style="margin-bottom: 8px;">
                        <input id="layer-search-input" type="text" placeholder="Search layers..."
                            style="width: 100%; padding: 8px 10px; border-radius: var(--border-radius); border: 1px solid rgba(255, 255, 255, 0.1); background-color: var(--bg-light); color: var(--text-primary); font-size: 13px; outline: none;">
                        <button id="layer-search-clear-btn" class="search-clear-btn" type="button"
                            aria-label="Clear layer search" title="Clear search">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div id="layers-list"
                        style="display: flex; flex-direction: column-reverse; gap: 4px; flex: 1; overflow-y: auto;">
                        <!-- Layers will be populated here -->
                    </div>
                </div>
                <div class="panel-footer">
                    <button id="add-layer-btn" title="Add Layer"><img src="icons/ui/plus.svg" alt="Add Layer"></button>
                    <button id="add-group-btn" title="Add Group"><img src="icons/ui/add-group.svg"
                            alt="Add Group"></button>
                    <button id="duplicate-layer-btn" title="Duplicate Layer"><img src="icons/ui/duplicate.svg"
                            alt="Duplicate"></button>
                    <button id="add-image-layer-btn" title="Add Image"><img src="icons/ui/image-add.svg"
                            alt="Add Image"></button>
                    <button id="delete-layer-btn" title="Delete Layer" class="delete-drop-zone"><img
                            src="icons/ui/delete.svg" alt="Delete"></button>
                </div>
            </div>

            <!-- Properties Panel -->
            <div class="panel" id="properties-panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-properties.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Properties</span>
                    </span>
                    <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6225_465)">
                            <path
                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                fill="black" />
                        </g>
                        <defs>
                            <clipPath id="clip0_6225_465">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <div class="panel-content" style="display:flex;flex-direction:column;gap:16px;">
                    <div id="properties-no-tool"
                        style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px 0;">
                        Select a tool to view properties
                    </div>
                    <div id="properties-controls" style="display:none;flex-direction:column;gap:12px;">
                        <!-- Selection Controls -->
                        <div class="effect-control" id="prop-selection-control" style="display:none;">
                            <div style="display:flex;flex-direction:column;gap:8px;">
                                <button id="select-all-btn" class="action-btn"
                                    style="width:100%;padding:8px;background-color:var(--bg-light);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);color:var(--text-primary);cursor:pointer;font-size:13px;transition:background-color 0.2s;display:flex;align-items:center;justify-content:flex-start;gap:8px;"
                                    title="Select All (Ctrl/Cmd+A)">
                                    <img src="icons/ui/select-all.svg" alt=""
                                        style="width:16px;height:16px;filter:invert(90%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);">
                                    <span>Select All</span>
                                </button>
                                <button id="deselect-all-btn" class="action-btn"
                                    style="width:100%;padding:8px;background-color:var(--bg-light);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);color:var(--text-primary);cursor:pointer;font-size:13px;transition:background-color 0.2s;display:flex;align-items:center;justify-content:flex-start;gap:8px;"
                                    title="Deselect All (Ctrl/Cmd+D)">
                                    <img id="deselect-icon" src="icons/ui/deselect-rectangular.svg" alt=""
                                        style="width:16px;height:16px;filter:invert(90%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);">
                                    <span>Deselect All</span>
                                </button>
                                <button id="invert-selection-btn" class="action-btn"
                                    style="width:100%;padding:8px;background-color:var(--bg-light);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);color:var(--text-primary);cursor:pointer;font-size:13px;transition:background-color 0.2s;display:flex;align-items:center;justify-content:flex-start;gap:8px;"
                                    title="Invert Selection (Ctrl/Cmd+Shift+I)">
                                    <img src="icons/ui/selection-invert.svg" alt=""
                                        style="width:16px;height:16px;filter:invert(90%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);">
                                    <span>Invert Selection</span>
                                </button>

                                <!-- Expand/Contract Selection Slider -->
                                <div class="effect-control" style="margin-top:8px;">
                                    <div class="effect-control-header">
                                        <span class="effect-label">Expand/Contract</span>
                                        <span id="selection-expand-value" class="effect-value-editable"
                                            style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0px</span>
                                    </div>
                                    <div class="effect-slider-wrapper">
                                        <input type="range" id="selection-expand-slider" min="-10" max="10" value="0"
                                            step="1" title="Expand or contract selection">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Opacity Control -->
                        <div class="effect-control" id="prop-opacity-control" style="display:none;">
                            <div class="effect-control-header">
                                <span class="effect-label">Opacity</span>
                                <span id="prop-opacity-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">100%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="prop-opacity-slider" min="0" max="100" value="100" step="1"
                                    title="Opacity">
                            </div>
                        </div>

                        <!-- Brush Size Control -->
                        <div class="effect-control" id="prop-size-control" style="display:none;">
                            <div class="effect-control-header">
                                <span class="effect-label">Brush Size</span>
                                <span id="prop-size-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">1</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="prop-size-slider" min="1" max="32" value="1" step="1"
                                    title="Brush Size">
                            </div>
                        </div>

                        <!-- Fill Pattern Control -->
                        <div class="effect-control" id="prop-pattern-control" style="display:none;">
                            <div class="effect-control-header">
                                <span class="effect-label">Pattern</span>
                            </div>
                            <select id="prop-pattern-select" title="Pattern" style="width:100%;">
                                <option value="solid">Solid</option>
                                <option value="checkerboard">Checkerboard</option>
                                <option value="vertical">Vertical Lines</option>
                                <option value="horizontal">Horizontal Lines</option>
                                <option value="diagonal-right">Diagonal Lines (\)</option>
                                <option value="diagonal-left">Diagonal Lines (/)</option>
                                <option value="grid">Grid</option>
                                <option value="dot">Dot</option>
                                <option value="random">Random</option>
                                <option value="cross">Cross</option>
                                <option value="brick">Brick</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Effects Panel -->
            <div class="panel" id="live-effects-panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-live effects.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Live Effects</span>
                    </span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_6225_465)">
                                <path
                                    d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                    fill="black" />
                            </g>
                            <defs>
                                <clipPath id="clip0_6225_465">
                                    <rect width="18" height="18" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>
                    </div>
                </div>
                <div class="panel-content" style="display:flex;flex-direction:column;gap:12px;">
                    <div id="effects-no-layer"
                        style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px 0;">
                        Select a layer to apply effects
                    </div>
                    <div id="effects-controls" style="display:none;flex-direction:column;gap:12px;">
                        <!-- Opacity -->
                        <div class="effect-control expandable" id="effect-opacity-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-opacity-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-opacity-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Opacity</span>
                                </button>
                                <span id="effect-opacity-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">100%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-opacity" min="0" max="100" value="100" step="1">
                            </div>
                            <div class="effect-extra" id="effect-opacity-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Opacity</span>
                                    <span id="effect-opacity-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-opacity-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>

                        <!-- Hue Shift -->
                        <div class="effect-control expandable" id="effect-hue-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-hue-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-hue-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Hue</span>
                                </button>
                                <span id="effect-hue-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-hue" min="-180" max="180" value="0" step="1">
                            </div>
                            <div class="effect-extra" id="effect-hue-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Hues</span>
                                    <span id="effect-hue-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-hue-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>

                        <!-- Saturation -->
                        <div class="effect-control expandable" id="effect-saturation-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-saturation-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-saturation-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Saturation</span>
                                </button>
                                <span id="effect-saturation-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-saturation" min="-100" max="100" value="0" step="1">
                            </div>
                            <div class="effect-extra" id="effect-saturation-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Saturation</span>
                                    <span id="effect-saturation-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-saturation-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>

                        <!-- Lightness -->
                        <div class="effect-control expandable" id="effect-lightness-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-lightness-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-lightness-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Lightness</span>
                                </button>
                                <span id="effect-lightness-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-lightness" min="-100" max="100" value="0" step="1">
                            </div>
                            <div class="effect-extra" id="effect-lightness-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Lightness</span>
                                    <span id="effect-lightness-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-lightness-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>


                        <!-- Brightness -->
                        <div class="effect-control expandable" id="effect-brightness-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-brightness-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-brightness-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Brightness</span>
                                </button>
                                <span id="effect-brightness-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-brightness" min="-100" max="100" value="0" step="1">
                            </div>
                            <div class="effect-extra" id="effect-brightness-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Brightness</span>
                                    <span id="effect-brightness-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-brightness-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>

                        <!-- Contrast -->
                        <div class="effect-control expandable" id="effect-contrast-control">
                            <div class="effect-control-header">
                                <button type="button" id="effect-contrast-toggle" class="effect-control-toggle"
                                    aria-expanded="false" aria-controls="effect-contrast-extra">
                                    <span class="effect-chevron-wrapper">
                                        <svg class="effect-chevron" viewBox="0 0 18 18" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                            <path
                                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <span class="effect-label">Contrast</span>
                                </button>
                                <span id="effect-contrast-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-contrast" min="-100" max="100" value="0" step="1">
                            </div>
                            <div class="effect-extra" id="effect-contrast-extra">
                                <div class="effect-extra-label-row">
                                    <span>Randomize Contrast</span>
                                    <span id="effect-contrast-randomization-value" class="effect-value-editable"
                                        style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0%</span>
                                </div>
                                <div class="effect-slider-wrapper">
                                    <input type="range" id="effect-contrast-randomization" min="0" max="100" value="0"
                                        step="1">
                                </div>
                            </div>
                        </div>

                        <!-- Blur -->
                        <div class="effect-control" id="effect-blur-control">
                            <div class="effect-control-header">
                                <span class="effect-label">Blur</span>
                                <span id="effect-blur-value" class="effect-value-editable"
                                    style="font-size:12px;color:var(--text-secondary);cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color 0.2s;">0px</span>
                            </div>
                            <div class="effect-slider-wrapper">
                                <input type="range" id="effect-blur" min="0" max="10" value="0" step="0.5">
                            </div>
                        </div>

                        <!-- Invert Effect -->
                        <div class="effect-control">
                            <div class="effect-control-header">
                                <span class="effect-label">Invert Colors</span>
                                <label class="toggle-switch" for="effect-invert">
                                    <input type="checkbox" id="effect-invert">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <button id="random-seed-btn" title="Randomize Seed" style="flex: 1; display: none;">
                        <img src="icons/ui/shuffle.svg" alt="Randomize">
                    </button>
                    <button id="reset-effects-btn" title="Reset All Effects" style="flex: 1; display: none;">
                        <img src="icons/ui/reset.svg" alt="Reset">
                    </button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-settings.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Settings</span>
                    </span>
                    <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6225_465)">
                            <path
                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                fill="black" />
                        </g>
                        <defs>
                            <clipPath id="clip0_6225_465">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <div class="panel-content settings-content" style="display:flex;flex-direction:column;gap:10px;">
                    <div class="control-row">
                        <label for="grid-size" class="control-label">Canvas Size:</label>
                        <div style="display:flex;align-items:center;gap:8px;flex-wrap:nowrap;width:100%;">
                            <div style="display:flex;align-items:center;gap:4px;">
                                <input type="number" id="custom-width" min="1" max="256" value="24" title="Width"
                                    style="width: 50px; background-color: var(--bg-light); color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.2); padding: 6px 8px; border-radius: var(--border-radius); font-size: 13px;">
                                <span style="color: var(--text-secondary);">&#xD7;</span>
                                <input type="number" id="custom-height" min="1" max="256" value="24" title="Height"
                                    style="width: 50px; background-color: var(--bg-light); color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.2); padding: 6px 8px; border-radius: var(--border-radius); font-size: 13px;">
                            </div>
                            <select id="grid-size" title="Preset Sizes"
                                style="flex:0 1 90px; margin-left:auto; height: 32px; background-color: var(--bg-light); color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--border-radius); font-size: 13px; padding: 0 8px;">
                                <option value="16">16&#xD7;16</option>
                                <option value="24" selected>24&#xD7;24</option>
                                <option value="32">32&#xD7;32</option>
                                <option value="48">48&#xD7;48</option>
                                <option value="64">64&#xD7;64</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-row">
                        <button id="subdivide-btn"
                            style="width: 100%; padding: 8px 12px; background-color: var(--bg-light); color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--border-radius); cursor: pointer; font-size: 13px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;"
                            onmouseover="if(!this.classList.contains('success')){this.style.backgroundColor='var(--bg-dark)';}"
                            onmouseout="if(!this.classList.contains('success')){this.style.backgroundColor='var(--bg-light)';}">
                            <svg id="subdivide-icon" width="14" height="14" viewBox="0 0 18 18" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <rect x="2" y="2" width="6" height="6" stroke="currentColor" stroke-width="1.5"
                                    fill="none" />
                                <rect x="10" y="2" width="6" height="6" stroke="currentColor" stroke-width="1.5"
                                    fill="none" />
                                <rect x="2" y="10" width="6" height="6" stroke="currentColor" stroke-width="1.5"
                                    fill="none" />
                                <rect x="10" y="10" width="6" height="6" stroke="currentColor" stroke-width="1.5"
                                    fill="none" />
                            </svg>
                            <span id="subdivide-text">Subdivide Canvas 2</span>
                        </button>
                    </div>
                    <div class="control-row">
                        <label class="control-label">Grid:</label>
                        <div class="segmented-control" id="grid-style-control">
                            <button class="segment-btn active" data-value="none" title="No Grid">
                                <img src="icons/ui/grid-none.svg" alt="No Grid">
                            </button>
                            <button class="segment-btn" data-value="lines" title="Square Grid">
                                <img src="icons/ui/grid-square.svg" alt="Square Grid">
                            </button>
                            <button class="segment-btn" data-value="dots" title="Dot Grid">
                                <img src="icons/ui/grid-dot.svg" alt="Dot Grid">
                            </button>
                            <button class="segment-btn" data-value="alpha" title="Alpha Grid">
                                <img src="icons/ui/grid-transparency.svg" alt="Alpha Grid">
                            </button>
                        </div>
                    </div>
                    <div class="control-row">
                        <label class="control-label">Symmetry:</label>
                        <div class="segmented-control" id="symmetry-mode-control">
                            <button class="segment-btn active" data-value="none" title="No Symmetry">
                                <img src="icons/ui/symmetry-none.svg" alt="No Symmetry">
                            </button>
                            <button class="segment-btn" data-value="vertical" title="Vertical Symmetry">
                                <img src="icons/ui/symmetry-vertical.svg" alt="Vertical Symmetry">
                            </button>
                            <button class="segment-btn" data-value="horizontal" title="Horizontal Symmetry">
                                <img src="icons/ui/symmetry-horizontal.svg" alt="Horizontal Symmetry">
                            </button>
                            <button class="segment-btn" data-value="both" title="Horizontal + Vertical Symmetry">
                                <img src="icons/ui/symmetry-horizontal-and-vertical.svg" alt="H+V Symmetry">
                            </button>
                            <button class="segment-btn" data-value="rotational" title="Rotational Symmetry">
                                <img src="icons/ui/symmetry-rotational.svg" alt="Rotational Symmetry">
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel export-panel">
                <div class="panel-header" onclick="togglePanel(this, event)" title="Click to expand/collapse"
                    style="display:flex;align-items:center;justify-content:space-between;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <img src="icons/ui/panel-export.svg" alt="" class="panel-icon">
                        <span class="panel-title" style="cursor: grab;">Export</span>
                    </span>
                    <svg class="expand-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_6225_465)">
                            <path
                                d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                fill="black" />
                        </g>
                        <defs>
                            <clipPath id="clip0_6225_465">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <div class="panel-content">
                    <div class="save-buttons-column"
                        style="display: flex; flex-direction: column-reverse; gap: 8px; align-items: stretch;">
                        <!-- Export Size Multiplier Control -->
                        <div class="control-row" style="margin-bottom: 8px;">
                            <label for="export-multiplier" class="control-label">Export Size:</label>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <span style="color: var(--text-secondary); font-size: 13px;"></span>
                                <input type="number" id="export-multiplier" min="1" max="100" value="1" step="1"
                                    title="Export Size Multiplier"
                                    style="width: 60px; background-color: var(--bg-light); color: var(--text-primary); border: 1px solid rgba(255, 255, 255, 0.2); padding: 6px 8px; border-radius: var(--border-radius); font-size: 13px;">
                            </div>
                        </div>
                        <div class="export-row" style="display:flex; gap:6px; align-items:center;">
                            <button id="save-btn" class="save-btn" title="Export PNG"
                                style="padding: 8px; font-size: 1rem; flex:1;">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M15.5 5.65C15.1473 5.57028 14.7838 5.55034 14.4245 5.591C14.622 4.86977 14.622 4.10873 14.4245 3.3875C14.2387 2.70745 13.877 2.08836 13.3758 1.59259C12.8745 1.09682 12.2515 0.741876 11.5695 0.563498C11.008 0.412293 10.4206 0.38285 9.84673 0.477143C9.27287 0.571436 8.7258 0.787287 8.24216 1.11023C7.75852 1.43318 7.34949 1.85576 7.04248 2.34966C6.73546 2.84356 6.53755 3.39738 6.462 3.974C5.91247 3.82787 5.33553 3.81843 4.7815 3.9465C4.15196 4.09462 3.57723 4.41799 3.12383 4.87918C2.67043 5.34037 2.35689 5.92052 2.2195 6.5525C2.10531 7.08758 2.11867 7.64203 2.2585 8.171C1.95437 8.11858 1.6421 8.13983 1.34787 8.23295C1.05364 8.32608 0.786012 8.48837 0.567419 8.70622C0.348827 8.92408 0.185635 9.19116 0.0915214 9.48508C-0.00259266 9.779 -0.0248881 10.0912 0.0265036 10.3955C0.119244 10.8558 0.371002 11.2688 0.737673 11.5622C1.10434 11.8556 1.56254 12.0105 2.032 12H8V7.5C8 7.36739 8.05268 7.24021 8.14645 7.14645C8.24022 7.05268 8.3674 7 8.5 7H9.5C9.63261 7 9.75979 7.05268 9.85356 7.14645C9.94733 7.24021 10 7.36739 10 7.5V12H14.786C15.5773 12.0014 16.3414 11.7109 16.9319 11.184C17.5223 10.6572 17.8977 9.93106 17.9861 9.14468C18.0745 8.3583 17.8698 7.56694 17.4111 6.92212C16.9523 6.2773 16.2719 5.82435 15.5 5.65Z"
                                        fill="currentColor" />
                                    <path
                                        d="M8 14H5.85C5.75717 14 5.66815 14.0369 5.60251 14.1025C5.53688 14.1682 5.5 14.2572 5.5 14.35C5.50004 14.3957 5.50922 14.4409 5.527 14.483C5.54477 14.525 5.57078 14.5631 5.6035 14.595L8.8375 17.6675C8.88278 17.7062 8.94041 17.7275 9 17.7275C9.05959 17.7275 9.11722 17.7062 9.1625 17.6675L12.397 14.6C12.4296 14.568 12.4554 14.5299 12.4731 14.4878C12.4908 14.4458 12.4999 14.4006 12.5 14.355C12.5 14.2622 12.4631 14.1732 12.3975 14.1075C12.3319 14.0419 12.2428 14.005 12.15 14.005H10V12H8V14Z"
                                        fill="currentColor" />
                                </svg>
                                Export PNG
                            </button>
                            <button id="copy-png-btn" class="save-btn" title="Copy PNG" aria-label="Copy PNG"
                                style="width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;">
                                <svg width="20" height="20" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                    <path
                                        d="M5 6H1.5C1.36739 6 1.24021 6.05268 1.14645 6.14645C1.05268 6.24021 1 6.36739 1 6.5V16.5C1 16.6326 1.05268 16.7598 1.14645 16.8536C1.24021 16.9473 1.36739 17 1.5 17H11.5C11.6326 17 11.7598 16.9473 11.8536 16.8536C11.9473 16.7598 12 16.6326 12 16.5V13H5.5C5.36739 13 5.24021 12.9473 5.14645 12.8536C5.05268 12.7598 5 12.6326 5 12.5V6Z"
                                        fill="currentColor" />
                                    <path
                                        d="M7 11H16V2H7V11ZM17 11.5L16.9902 11.6006C16.9503 11.7961 16.7961 11.9503 16.6006 11.9902L16.5 12H6.5C6.25829 12 6.05629 11.8286 6.00977 11.6006L6 11.5V1.5C6 1.22386 6.22386 1 6.5 1H16.5L16.6006 1.00977C16.8286 1.05629 17 1.25829 17 1.5V11.5Z"
                                        fill="currentColor" />
                                </svg>
                            </button>
                        </div>
                        <div class="export-row" style="display:flex; gap:6px; align-items:center;">
                            <button id="save-svg-btn" class="save-btn" title="Export SVG"
                                style="padding: 8px; font-size: 1rem; flex:1;">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M15.5 5.65C15.1473 5.57028 14.7838 5.55034 14.4245 5.591C14.622 4.86977 14.622 4.10873 14.4245 3.3875C14.2387 2.70745 13.877 2.08836 13.3758 1.59259C12.8745 1.09682 12.2515 0.741876 11.5695 0.563498C11.008 0.412293 10.4206 0.38285 9.84673 0.477143C9.27287 0.571436 8.7258 0.787287 8.24216 1.11023C7.75852 1.43318 7.34949 1.85576 7.04248 2.34966C6.73546 2.84356 6.53755 3.39738 6.462 3.974C5.91247 3.82787 5.33553 3.81843 4.7815 3.9465C4.15196 4.09462 3.57723 4.41799 3.12383 4.87918C2.67043 5.34037 2.35689 5.92052 2.2195 6.5525C2.10531 7.08758 2.11867 7.64203 2.2585 8.171C1.95437 8.11858 1.6421 8.13983 1.34787 8.23295C1.05364 8.32608 0.786012 8.48837 0.567419 8.70622C0.348827 8.92408 0.185635 9.19116 0.0915214 9.48508C-0.00259266 9.779 -0.0248881 10.0912 0.0265036 10.3955C0.119244 10.8558 0.371002 11.2688 0.737673 11.5622C1.10434 11.8556 1.56254 12.0105 2.032 12H8V7.5C8 7.36739 8.05268 7.24021 8.14645 7.14645C8.24022 7.05268 8.3674 7 8.5 7H9.5C9.63261 7 9.75979 7.05268 9.85356 7.14645C9.94733 7.24021 10 7.36739 10 7.5V12H14.786C15.5773 12.0014 16.3414 11.7109 16.9319 11.184C17.5223 10.6572 17.8977 9.93106 17.9861 9.14468C18.0745 8.3583 17.8698 7.56694 17.4111 6.92212C16.9523 6.2773 16.2719 5.82435 15.5 5.65Z"
                                        fill="currentColor" />
                                    <path
                                        d="M8 14H5.85C5.75717 14 5.66815 14.0369 5.60251 14.1025C5.53688 14.1682 5.5 14.2572 5.5 14.35C5.50004 14.3957 5.50922 14.4409 5.527 14.483C5.54477 14.525 5.57078 14.5631 5.6035 14.595L8.8375 17.6675C8.88278 17.7062 8.94041 17.7275 9 17.7275C9.05959 17.7275 9.11722 17.7062 9.1625 17.6675L12.397 14.6C12.4296 14.568 12.4554 14.5299 12.4731 14.4878C12.4908 14.4458 12.4999 14.4006 12.5 14.355C12.5 14.2622 12.4631 14.1732 12.3975 14.1075C12.3319 14.0419 12.2428 14.005 12.15 14.005H10V12H8V14Z"
                                        fill="currentColor" />
                                </svg>
                                Export SVG
                            </button>
                            <button id="copy-svg-btn" class="save-btn" title="Copy SVG" aria-label="Copy SVG"
                                style="width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;">
                                <svg width="20" height="20" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                    <path
                                        d="M5 6H1.5C1.36739 6 1.24021 6.05268 1.14645 6.14645C1.05268 6.24021 1 6.36739 1 6.5V16.5C1 16.6326 1.05268 16.7598 1.14645 16.8536C1.24021 16.9473 1.36739 17 1.5 17H11.5C11.6326 17 11.7598 16.9473 11.8536 16.8536C11.9473 16.7598 12 16.6326 12 16.5V13H5.5C5.36739 13 5.24021 12.9473 5.14645 12.8536C5.05268 12.7598 5 12.6326 5 12.5V6Z"
                                        fill="currentColor" />
                                    <path
                                        d="M7 11H16V2H7V11ZM17 11.5L16.9902 11.6006C16.9503 11.7961 16.7961 11.9503 16.6006 11.9902L16.5 12H6.5C6.25829 12 6.05629 11.8286 6.00977 11.6006L6 11.5V1.5C6 1.22386 6.22386 1 6.5 1H16.5L16.6006 1.00977C16.8286 1.05629 17 1.25829 17 1.5V11.5Z"
                                        fill="currentColor" />
                                </svg>
                            </button>
                        </div>
                        <div style="height:1px;background-color:var(--bg-light);opacity:0.35;margin:8px 0;"></div>
                        <div class="export-row" style="display:flex; gap:6px; align-items:center;">
                            <button id="save-project-panel-btn" class="save-btn" title="Save Project"
                                style="padding: 8px; font-size: 1rem; flex:1;">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_save_tool)">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M14.08 1.09L16.85 3.86C16.95 3.95 17 4.08 17 4.21V16.5C17 16.78 16.78 17 16.5 17H1.5C1.22 17 1 16.78 1 16.5V1.5C1 1.22 1.22 1 1.5 1H6V5H13V1H13.79C13.9 1 13.99 1.03 14.08 1.09ZM4 16H14V8H4V16ZM10 1H12V4H10V1Z"
                                            fill="currentColor" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_save_tool">
                                            <rect width="18" height="18" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                                Save Project
                            </button>
                        </div>
                        <div class="export-row" style="display:flex; gap:6px; align-items:center;">
                            <button id="load-project-panel-btn" class="save-btn" title="Load Project"
                                style="padding: 8px; font-size: 1rem; flex:1;">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_load_tool)">
                                        <path
                                            d="M4.345 7H16.6125L14.2795 14H2L4.345 7ZM6.9645 2H2C1.73478 2 1.48043 2.10536 1.29289 2.29289C1.10536 2.48043 1 2.73478 1 3V14.5C1 14.6326 1.05268 14.7598 1.14645 14.8536C1.24021 14.9473 1.36739 15 1.5 15H14.6395C14.7445 15 14.8468 14.967 14.932 14.9056C15.0171 14.8442 15.0808 14.7576 15.114 14.658L17.7805 6.658C17.8055 6.58287 17.8123 6.50288 17.8004 6.4246C17.7885 6.34632 17.7581 6.272 17.7118 6.20775C17.6655 6.1435 17.6047 6.09116 17.5342 6.05504C17.4637 6.01893 17.3857 6.00006 17.3065 6H16V4.5C16 4.36739 15.9473 4.24021 15.8536 4.14645C15.7598 4.05268 15.6326 4 15.5 4L9.334 4.0035L7.684 2.3035C7.59056 2.20724 7.47871 2.13076 7.3551 2.07862C7.23149 2.02648 7.09866 1.99974 6.9645 2Z"
                                            fill="currentColor" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_load_tool">
                                            <rect width="18" height="18" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                                Load Project
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <p class="footer-text">
                    Created by <a href="https://samolevsky.com" target="_blank" rel="noopener noreferrer"
                        class="footer-link">Samolevsky.com</a>
                </p>
                <div class="footer-tooltip">Discover more design tools</div>
            </div>
        </div>

        <div class="canvas-container">
            <div class="pixel-grid-wrapper"
                style="min-width: max-content; min-height: max-content; position: relative;">
                <div class="pixel-grid" id="pixel-grid"></div>
                <svg id="rect-dash-overlay" class="rect-dash-overlay" style="display:none;"></svg>
            </div>
            <div class="zoom-controls"
                style="position: absolute; bottom: 20px; left: 20px; display: none; gap: 8px; z-index: 100;">
                <button id="zoom-out-btn" class="zoom-btn" title="Zoom Out"
                    style="width: 32px; height: 32px; padding: 0; border-radius: 50%; background-color: var(--bg-medium); display: flex; align-items: center; justify-content: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <span id="zoom-level"
                    style="background-color: var(--bg-medium); padding: 6px 10px; border-radius: var(--border-radius); font-size: 13px; color: var(--text-primary);">100%</span>
                <button id="zoom-in-btn" class="zoom-btn" title="Zoom In"
                    style="width: 32px; height: 32px; padding: 0; border-radius: 50%; background-color: var(--bg-medium); display: flex; align-items: center; justify-content: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <button id="zoom-reset-btn" class="zoom-btn" title="Reset Zoom"
                    style="width: 32px; height: 32px; padding: 0; border-radius: 50%; background-color: var(--bg-medium); display: flex; align-items: center; justify-content: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                        <path d="M21 3v5h-5"></path>
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                        <path d="M3 21v-5h5"></path>
                    </svg>
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div id="status-bar">Ready to draw</div>
        <div style="display: flex; align-items: center; gap: 12px;">
            <div id="ui-tooltip" style="color: var(--text-secondary); font-size: 12px; display: none;"></div>
            <div id="coordinates"></div>
            <button id="help-btn" class="help-button" title="Help"
                style="background: none; border: none; cursor: pointer; color: var(--text-primary); padding: 6px; border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; opacity: 0.7;">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M9 1C7.41775 1 5.87103 1.46919 4.55544 2.34824C3.23985 3.22729 2.21447 4.47672 1.60897 5.93853C1.00347 7.40034 0.84504 9.00887 1.15372 10.5607C1.4624 12.1126 2.22433 13.538 3.34315 14.6569C4.46197 15.7757 5.88743 16.5376 7.43928 16.8463C8.99113 17.155 10.5997 16.9965 12.0615 16.391C13.5233 15.7855 14.7727 14.7602 15.6518 13.4446C16.5308 12.129 17 10.5823 17 9C17 6.87827 16.1571 4.84344 14.6569 3.34315C13.1566 1.84285 11.1217 1 9 1ZM8.85 3.15C9.2099 3.13034 9.56286 3.25446 9.83124 3.49504C10.0996 3.73563 10.2614 4.07297 10.2811 4.43286C10.2834 4.47587 10.2837 4.51892 10.282 4.562C10.297 4.75384 10.2702 4.94665 10.2035 5.12715C10.1368 5.30765 10.0318 5.47156 9.89574 5.6076C9.75965 5.74364 9.5957 5.84858 9.41518 5.9152C9.23465 5.98182 9.04184 6.00853 8.85 5.9935C8.65893 6.0051 8.46756 5.97601 8.28857 5.90815C8.10957 5.84029 7.94702 5.73521 7.81165 5.59985C7.67629 5.46449 7.57121 5.30194 7.50335 5.12294C7.43549 4.94394 7.4064 4.75258 7.418 4.5615C7.4034 4.2015 7.53241 3.85045 7.77665 3.58556C8.02088 3.32068 8.36033 3.16367 8.72033 3.14907C8.76355 3.14731 8.80678 3.14762 8.85 3.15ZM11 13.5C11 13.6326 10.9473 13.7598 10.8536 13.8536C10.7598 13.9473 10.6326 14 10.5 14H7.5C7.3674 14 7.24022 13.9473 7.14645 13.8536C7.05268 13.7598 7 13.6326 7 13.5V12.5C7 12.3674 7.05268 12.2402 7.14645 12.1464C7.24022 12.0527 7.3674 12 7.5 12H8V9H7.5C7.3674 9 7.24022 8.94732 7.14645 8.85355C7.05268 8.75979 7 8.63261 7 8.5V7.5C7 7.36739 7.05268 7.24021 7.14645 7.14645C7.24022 7.05268 7.3674 7 7.5 7H9.5C9.63261 7 9.75979 7.05268 9.85356 7.14645C9.94733 7.24021 10 7.36739 10 7.5V12H10.5C10.6326 12 10.7598 12.0527 10.8536 12.1464C10.9473 12.2402 11 12.3674 11 12.5V13.5Z"
                        fill="currentColor" />
                </svg>
            </button>
        </div>
    </footer>

    <!-- Help Modal -->
    <div id="help-modal" class="help-modal" style="display: none;">
        <div class="help-modal-overlay"></div>
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2>About PixelDraw</h2>
                <button id="help-modal-close" class="help-modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="help-modal-body">
                <p>PixelDraw is a sleek, web-based pixel art tool built for artists of all skill levels. With an
                    intuitive interface and a full suite of toolsincluding pencil, eraser, fill, shapes, and linesit
                    makes creating pixel-perfect art simple and enjoyable.</p>
                <p>Choose from preset canvas sizes or define your own, and bring your ideas to life with powerful
                    features like symmetry modes, grid customization, and a flexible color palette. Designed for
                    precision, PixelDraw includes export options in both PNG and SVG formats.</p>

                <div class="eula-section">
                    <div class="eula-header collapsed" onclick="toggleEULA()">
                        <svg class="eula-expand-icon" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_6225_465)">
                                <path
                                    d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z"
                                    fill="black" />
                            </g>
                            <defs>
                                <clipPath id="clip0_6225_465">
                                    <rect width="18" height="18" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>
                        <span>End User License Agreement</span>
                    </div>
                    <div class="eula-content collapsed">
                        <h3>License Agreement</h3>
                        <p>This End User License Agreement ("Agreement") is between you ("User" or "You") and Arseny
                            Samolevsky ("Licensor") regarding your use of PixelDraw ("Software").</p>

                        <h3>Grant of License</h3>
                        <p>Subject to the terms of this Agreement, Licensor grants you a non-exclusive, non-transferable
                            license to use PixelDraw for personal and commercial purposes. You may create, edit, and
                            export pixel art using the Software.</p>

                        <h3>Restrictions</h3>
                        <p>You may not:</p>
                        <p> Reverse engineer, decompile, or disassemble the Software</p>
                        <p> Remove or modify any copyright notices or proprietary markings</p>
                        <p> Redistribute, sublicense, or sell the Software</p>
                        <p> Use the Software for any illegal or unauthorized purpose</p>

                        <h3>Ownership</h3>
                        <p>You retain full ownership and rights to any artwork created using PixelDraw. The Software
                            itself remains the intellectual property of Arseny Samolevsky.</p>

                        <h3>Privacy</h3>
                        <p>PixelDraw operates entirely in your browser. No personal data, artwork, or usage information
                            is collected, stored, or transmitted to external servers.</p>

                        <h3>Disclaimer of Warranties</h3>
                        <p>The Software is provided "AS IS" without warranty of any kind. Licensor disclaims all
                            warranties, express or implied, including but not limited to the warranties of
                            merchantability, fitness for a particular purpose, and non-infringement.</p>

                        <h3>Limitation of Liability</h3>
                        <p>In no event shall Arseny Samolevsky be liable for any special, incidental, indirect, or
                            consequential damages whatsoever arising out of the use of or inability to use the Software.
                        </p>

                        <h3>Termination</h3>
                        <p>This license is effective until terminated. Your rights under this license will terminate
                            automatically without notice if you fail to comply with any term of this Agreement.</p>

                        <h3>Governing Law</h3>
                        <p>This Agreement shall be governed by and construed in accordance with the laws of the
                            jurisdiction in which Arseny Samolevsky resides, without regard to conflict of law
                            principles.</p>

                        <p><strong>By using PixelDraw, you acknowledge that you have read this Agreement, understand it,
                                and agree to be bound by its terms and conditions.</strong></p>
                    </div>
                </div>
            </div>
            <div class="help-modal-footer">
                <button id="discover-more-btn" class="discover-more-btn">
                    Discover More Design Tools
                </button>
            </div>
        </div>
    </div>

    <script>
        function togglePanel(header, evt) {
            const content = header.nextElementSibling;
            const expandIcon = header.querySelector('.expand-icon');
            const panel = header.parentElement;
            const isModifier = !!(evt && (evt.metaKey || evt.ctrlKey));
            const targetExpand = header.classList.contains('collapsed');

            if (isModifier) {
                const panels = panel.parentElement.querySelectorAll('.panel');
                panels.forEach((p) => {
                    const h = p.querySelector('.panel-header');
                    const c = p.querySelector('.panel-content');
                    const i = h && h.querySelector('.expand-icon');
                    if (h && c) {
                        if (targetExpand) {
                            h.classList.remove('collapsed');
                            c.classList.remove('collapsed');
                            p.classList.remove('collapsed');
                            if (i) {
                                i.innerHTML = `
                                    <g clip-path="url(#clip0_6225_465)">
                                        <path d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z" fill="black"/>
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_6225_465">
                                            <rect width="18" height="18" fill="white"/>
                                        </clipPath>
                                    </defs>`;
                            }
                        } else {
                            h.classList.add('collapsed');
                            c.classList.add('collapsed');
                            p.classList.add('collapsed');
                            if (i) {
                                i.innerHTML = `
                                    <g clip-path="url(#clip0_6225_461)">
                                        <path d="M12 9C12 9.1309 11.9742 9.26053 11.924 9.38142C11.8738 9.50232 11.8002 9.61212 11.7075 9.7045L7.71601 13.6945C7.62772 13.7993 7.51884 13.8848 7.39612 13.9458C7.27341 14.0068 7.13947 14.0419 7.00262 14.0489C6.86578 14.0559 6.72894 14.0348 6.60062 13.9867C6.47229 13.9387 6.3552 13.8648 6.25662 13.7696C6.15805 13.6744 6.08008 13.56 6.02757 13.4335C5.97505 13.3069 5.94911 13.1709 5.95135 13.0339C5.95359 12.8969 5.98396 12.7618 6.04059 12.637C6.09721 12.5122 6.17887 12.4004 6.28051 12.3085L6.30501 12.284L9.59051 9L6.30451 5.715C6.13458 5.52692 6.04242 5.28132 6.04666 5.02788C6.05091 4.77443 6.15124 4.53206 6.32737 4.34977C6.5035 4.16748 6.74228 4.05888 6.99542 4.04592C7.24857 4.03297 7.49719 4.11664 7.69101 4.28L7.71551 4.3045L11.707 8.2945C11.8 8.38696 11.8737 8.4969 11.924 8.61798C11.9743 8.73906 12.0001 8.86889 12 9Z" fill="black"/>
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_6225_461">
                                            <rect width="18" height="18" fill="white"/>
                                        </clipPath>
                                    </defs>`;
                            }
                        }
                    }
                });
                return;
            }

            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            panel.classList.toggle('collapsed');

            if (header.classList.contains('collapsed')) {
                expandIcon.innerHTML = `
                    <g clip-path="url(#clip0_6225_461)">
                        <path d="M12 9C12 9.1309 11.9742 9.26053 11.924 9.38142C11.8738 9.50232 11.8002 9.61212 11.7075 9.7045L7.71601 13.6945C7.62772 13.7993 7.51884 13.8848 7.39612 13.9458C7.27341 14.0068 7.13947 14.0419 7.00262 14.0489C6.86578 14.0559 6.72894 14.0348 6.60062 13.9867C6.47229 13.9387 6.3552 13.8648 6.25662 13.7696C6.15805 13.6744 6.08008 13.56 6.02757 13.4335C5.97505 13.3069 5.94911 13.1709 5.95135 13.0339C5.95359 12.8969 5.98396 12.7618 6.04059 12.637C6.09721 12.5122 6.17887 12.4004 6.28051 12.3085L6.30501 12.284L9.59051 9L6.30451 5.715C6.13458 5.52692 6.04242 5.28132 6.04666 5.02788C6.05091 4.77443 6.15124 4.53206 6.32737 4.34977C6.5035 4.16748 6.74228 4.05888 6.99542 4.04592C7.24857 4.03297 7.49719 4.11664 7.69101 4.28L7.71551 4.3045L11.707 8.2945C11.8 8.38696 11.8737 8.4969 11.924 8.61798C11.9743 8.73906 12.0001 8.86889 12 9Z" fill="black"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_6225_461">
                            <rect width="18" height="18" fill="white"/>
                        </clipPath>
                    </defs>`;
            } else {
                expandIcon.innerHTML = `
                    <g clip-path="url(#clip0_6225_465)">
                        <path d="M4 7.01001C4.00063 6.8127 4.05962 6.61998 4.16955 6.45612C4.27947 6.29226 4.43542 6.16458 4.61775 6.08915C4.80008 6.01373 5.00065 5.99393 5.19421 6.03225C5.38777 6.07058 5.56566 6.1653 5.7055 6.30451L8.9945 9.59051L12.2835 6.30451C12.471 6.13092 12.7177 6.03566 12.9732 6.03828C13.2287 6.0409 13.4734 6.1412 13.6573 6.31859C13.8412 6.49598 13.9501 6.73702 13.9619 6.99223C13.9736 7.24744 13.8873 7.49747 13.7205 7.69101L13.696 7.71551L9.7 11.7075C9.51253 11.8945 9.25855 11.9995 8.99375 11.9995C8.72895 11.9995 8.47497 11.8945 8.2875 11.7075L4.293 7.71601C4.20001 7.62347 4.12625 7.51345 4.07596 7.39228C4.02568 7.27112 3.99986 7.1412 4 7.01001Z" fill="black"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_6225_465">
                            <rect width="18" height="18" fill="white"/>
                        </clipPath>
                    </defs>`;
            }

            if (window.matchMedia('(max-width: 600px)').matches && !header.classList.contains('collapsed') && !isModifier) {
                const panels = panel.parentElement.querySelectorAll('.panel');
                panels.forEach((p) => {
                    if (p !== panel) {
                        const h = p.querySelector('.panel-header');
                        const c = p.querySelector('.panel-content');
                        const i = h && h.querySelector('.expand-icon');
                        if (h && c) {
                            h.classList.add('collapsed');
                            c.classList.add('collapsed');
                            p.classList.add('collapsed');
                            if (i) {
                                i.innerHTML = `
                                    <g clip-path="url(#clip0_6225_461)">
                                        <path d="M12 9C12 9.1309 11.9742 9.26053 11.924 9.38142C11.8738 9.50232 11.8002 9.61212 11.7075 9.7045L7.71601 13.6945C7.62772 13.7993 7.51884 13.8848 7.39612 13.9458C7.27341 14.0068 7.13947 14.0419 7.00262 14.0489C6.86578 14.0559 6.72894 14.0348 6.60062 13.9867C6.47229 13.9387 6.3552 13.8648 6.25662 13.7696C6.15805 13.6744 6.08008 13.56 6.02757 13.4335C5.97505 13.3069 5.94911 13.1709 5.95135 13.0339C5.95359 12.8969 5.98396 12.7618 6.04059 12.637C6.09721 12.5122 6.17887 12.4004 6.28051 12.3085L6.30501 12.284L9.59051 9L6.30451 5.715C6.13458 5.52692 6.04242 5.28132 6.04666 5.02788C6.05091 4.77443 6.15124 4.53206 6.32737 4.34977C6.5035 4.16748 6.74228 4.05888 6.99542 4.04592C7.24857 4.03297 7.49719 4.11664 7.69101 4.28L7.71551 4.3045L11.707 8.2945C11.8 8.38696 11.8737 8.4969 11.924 8.61798C11.9743 8.73906 12.0001 8.86889 12 9Z" fill="black"/>
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_6225_461">
                                            <rect width="18" height="18" fill="white"/>
                                        </clipPath>
                                    </defs>`;
                            }
                        }
                    }
                });
            }
        }

        // Toggle EULA section
        function toggleEULA() {
            const eulaHeader = document.querySelector('.eula-header');
            const eulaContent = document.querySelector('.eula-content');

            eulaHeader.classList.toggle('collapsed');
            eulaContent.classList.toggle('collapsed');
        }

        // Help modal functionality
        document.addEventListener('DOMContentLoaded', function () {
            const helpBtn = document.getElementById('help-btn');
            const helpModal = document.getElementById('help-modal');
            const helpModalClose = document.getElementById('help-modal-close');
            const discoverMoreBtn = document.getElementById('discover-more-btn');
            const helpModalOverlay = document.querySelector('.help-modal-overlay');

            if (helpBtn && helpModal) {
                // Open help modal
                helpBtn.addEventListener('click', function () {
                    helpModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                });

                // Open help modal when clicking on app title
                const appTitle = document.querySelector('.app-title');
                if (appTitle) {
                    appTitle.addEventListener('click', function () {
                        helpModal.style.display = 'flex';
                        document.body.style.overflow = 'hidden';
                    });
                }

                // Close help modal
                function closeModal() {
                    helpModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }

                if (helpModalClose) {
                    helpModalClose.addEventListener('click', closeModal);
                }

                if (helpModalOverlay) {
                    helpModalOverlay.addEventListener('click', closeModal);
                }

                // Close modal on Escape key
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' && helpModal.style.display === 'flex') {
                        closeModal();
                    }
                });

                // Open samolevsky.com in new tab
                if (discoverMoreBtn) {
                    discoverMoreBtn.addEventListener('click', function () {
                        window.open('https://samolevsky.com/', '_blank');
                    });
                }
            }
            if (window.matchMedia('(max-width: 600px)').matches) {
                const panels = document.querySelectorAll('.left-panels .panel');
                panels.forEach((p, idx) => {
                    if (idx > 0) {
                        const h = p.querySelector('.panel-header');
                        const c = p.querySelector('.panel-content');
                        const i = h && h.querySelector('.expand-icon');
                        if (h && c) {
                            h.classList.add('collapsed');
                            c.classList.add('collapsed');
                            p.classList.add('collapsed');
                            if (i) {
                                i.innerHTML = `
                                    <g clip-path="url(#clip0_6225_461)">
                                        <path d="M12 9C12 9.1309 11.9742 9.26053 11.924 9.38142C11.8738 9.50232 11.8002 9.61212 11.7075 9.7045L7.71601 13.6945C7.62772 13.7993 7.51884 13.8848 7.39612 13.9458C7.27341 14.0068 7.13947 14.0419 7.00262 14.0489C6.86578 14.0559 6.72894 14.0348 6.60062 13.9867C6.47229 13.9387 6.3552 13.8648 6.25662 13.7696C6.15805 13.6744 6.08008 13.56 6.02757 13.4335C5.97505 13.3069 5.94911 13.1709 5.95135 13.0339C5.95359 12.8969 5.98396 12.7618 6.04059 12.637C6.09721 12.5122 6.17887 12.4004 6.28051 12.3085L6.30501 12.284L9.59051 9L6.30451 5.715C6.13458 5.52692 6.04242 5.28132 6.04666 5.02788C6.05091 4.77443 6.15124 4.53206 6.32737 4.34977C6.5035 4.16748 6.74228 4.05888 6.99542 4.04592C7.24857 4.03297 7.49719 4.11664 7.69101 4.28L7.71551 4.3045L11.707 8.2945C11.8 8.38696 11.8737 8.4969 11.924 8.61798C11.9743 8.73906 12.0001 8.86889 12 9Z" fill="black"/>
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_6225_461">
                                            <rect width="18" height="18" fill="white"/>
                                        </clipPath>
                                    </defs>`;
                            }
                        }
                    }
                });
            }

            // UI Tooltip System
            const uiTooltip = document.getElementById('ui-tooltip');

            // Tooltip mappings for all UI elements
            const tooltipMap = {
                // Sidebar panel elements
                'palette-select': 'Choose a color palette',
                'add-swatch-btn': 'Add a custom color to palette',
                'help-swatch-btn': 'Learn about color palettes',
                'add-layer-btn': 'Add a new drawing layer',
                'add-image-layer-btn': 'Import an image as a layer',
                'layer-search-input': 'Search layers by name',
                'layer-search-clear-btn': 'Clear layer search',
                'reset-effects-btn': 'Reset all effects to default',
                'effect-invert': 'Invert all colors in layer',
                'effect-hue': 'Shift hue of all colors',
                'effect-hue-randomization': 'Add random variation to hue',
                'effect-saturation': 'Adjust color saturation',
                'effect-saturation-randomization': 'Add random variation to saturation',
                'effect-lightness': 'Adjust color lightness',
                'effect-lightness-randomization': 'Add random variation to lightness',
                'effect-brightness': 'Adjust overall brightness',
                'effect-brightness-randomization': 'Add random variation to brightness',
                'effect-contrast': 'Adjust color contrast',
                'effect-contrast-randomization': 'Add random variation to contrast',
                'effect-opacity': 'Adjust layer opacity',
                'effect-opacity-randomization': 'Add random variation to opacity per pixel',
                'grid-size': 'Set canvas dimensions',
                'custom-width': 'Custom canvas width',
                'custom-height': 'Custom canvas height',
                'grid-style-control': 'Toggle grid lines visibility',
                'symmetry-mode-control': 'Set drawing symmetry mode',
                'subdivide-btn': 'Double canvas size',
                'theme-toggle': 'Switch between light and dark theme',
                'save-btn': 'Export as PNG image',
                'save-svg-btn': 'Export as SVG vector',
                'copy-png-btn': 'Copy PNG to clipboard',
                'copy-svg-btn': 'Copy SVG to clipboard',
                'save-project-panel-btn': 'Save project file',
                'load-project-panel-btn': 'Load project file'
            };

            // Function to show tooltip
            function showTooltip(text) {
                if (uiTooltip && text) {
                    uiTooltip.textContent = text;
                    uiTooltip.style.display = 'block';
                }
            }

            // Function to hide tooltip
            function hideTooltip() {
                if (uiTooltip) {
                    uiTooltip.style.display = 'none';
                    uiTooltip.textContent = '';
                }
            }

            // Add hover listeners to all mapped elements
            Object.keys(tooltipMap).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('mouseenter', () => showTooltip(tooltipMap[id]));
                    element.addEventListener('mouseleave', hideTooltip);
                }
            });

            // Add tooltips for dynamically created elements using event delegation
            document.addEventListener('mouseover', function (e) {
                const target = e.target;

                // Layer items
                if (target.closest('.layer-item')) {
                    const layerItem = target.closest('.layer-item');
                    if (target.classList.contains('layer-visibility-btn')) {
                        showTooltip('Toggle layer visibility');
                    } else if (target.classList.contains('layer-delete-btn')) {
                        showTooltip('Delete layer');
                    } else if (target.classList.contains('layer-duplicate-btn')) {
                        showTooltip('Duplicate layer');
                    } else if (target.classList.contains('layer-name')) {
                        showTooltip('Click to rename layer');
                    } else if (target.classList.contains('layer-opacity-slider')) {
                        showTooltip('Adjust layer opacity');
                    }
                }

                // Color swatches
                if (target.classList.contains('color') && !target.id) {
                    showTooltip('Click to select color');
                }

                // Panel buttons
                if (target.closest('.panel-button')) {
                    const btn = target.closest('.panel-button');
                    if (btn.id && tooltipMap[btn.id]) {
                        showTooltip(tooltipMap[btn.id]);
                    }
                }

                // Effect control toggles
                if (target.closest('.effect-control-toggle')) {
                    showTooltip('Expand for more options');
                }

                // Toggle switches
                if (target.closest('.toggle-switch')) {
                    const toggle = target.closest('.toggle-switch');
                    const input = toggle.querySelector('input');
                    if (input && input.id && tooltipMap[input.id]) {
                        showTooltip(tooltipMap[input.id]);
                    }
                }
            });

            document.addEventListener('mouseout', function (e) {
                const target = e.target;
                if (target.closest('.layer-item') ||
                    target.classList.contains('color') ||
                    target.closest('.panel-button') ||
                    target.closest('.effect-control-toggle') ||
                    target.closest('.toggle-switch')) {
                    hideTooltip();
                }
            });
        });

        // Sidebar footer tooltip functionality
        (function () {
            const footerLink = document.querySelector('.footer-link');
            const footerTooltip = document.querySelector('.footer-tooltip');
            let tooltipTimeout = null;

            if (footerLink && footerTooltip) {
                footerLink.addEventListener('mouseenter', function () {
                    // Clear any existing timeout
                    if (tooltipTimeout) {
                        clearTimeout(tooltipTimeout);
                    }

                    // Show tooltip after 1.2 seconds
                    tooltipTimeout = setTimeout(function () {
                        footerTooltip.style.opacity = '1';
                    }, 1200);
                });

                footerLink.addEventListener('mouseleave', function () {
                    // Clear timeout and hide tooltip
                    if (tooltipTimeout) {
                        clearTimeout(tooltipTimeout);
                        tooltipTimeout = null;
                    }
                    footerTooltip.style.opacity = '0';
                });
            }
        })();
    </script>

    <!-- Canvas Context Menu -->
    <div id="canvas-context-menu" class="context-menu" style="display: none;">
        <div class="context-menu-item" id="context-deselect">
            <span>Deselect</span>
            <span class="context-menu-shortcut">Esc</span>
        </div>
        <div class="context-menu-item" id="context-invert-selection">
            <span>Invert Selection</span>
        </div>
    </div>

    <script src="js/theme.js"></script>
    <script src="js/palettes.js"></script>
    <script src="js/app.js"></script>
</body>

</html>
